<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Holiday Tarot 2026</title>

  <!-- html2canvas for download -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

  <style>
  :root{
    --bg1:#fdeef2;
    --bg2:#f7fbff;
    --ink:#1a1d2b;
    --muted:rgba(26,29,43,.65);

    --card:#ffffffcc;
    --stroke:rgba(26,29,43,.10);
    --shadow: 0 18px 55px rgba(0,0,0,.10);

    --accent1:#fb7185;
    --accent2:#60a5fa;
    --accent3:#34d399;

    /* share tree theming vars */
    --treeA:#34d399;
    --treeB:#10b981;
    --treeGlow: rgba(16,185,129,.22);
    --treeStar: rgba(255,214,140,.95);
    --treeStarGlow: rgba(255,214,140,.55);

    /* flip card dynamic height (JS will override per-card) */
    --flipH: 520px;
  }

  *{ box-sizing:border-box; }
  body{
    margin:0;
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "PingFang SC","Microsoft YaHei", sans-serif;
    color:var(--ink);
    background:
      radial-gradient(1200px 600px at 20% 0%, var(--bg1), transparent 60%),
      radial-gradient(1200px 600px at 80% 10%, var(--bg2), transparent 60%),
      linear-gradient(180deg, #fff, #fff);
    min-height:100vh;
  }

  .wrap{
    max-width:1180px;
    margin:0 auto;
    padding:26px 18px 40px;
  }

  header{
    text-align:center;
    margin-bottom:22px;
  }
  h1{
    margin:6px 0 8px;
    font-size:42px;
    letter-spacing:.2px;
  }
  .subtitle{
    margin:0 auto;
    max-width:860px;
    line-height:1.55;
    color:var(--muted);
    font-size:15px;
  }

  .topbar{
    display:flex;
    justify-content:center;
    gap:10px;
    margin-top:12px;
    align-items:center;
  }
  .pill{
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding:8px 12px;
    border-radius:999px;
    background:rgba(255,255,255,.75);
    border:1px solid var(--stroke);
    box-shadow: 0 10px 30px rgba(0,0,0,.06);
    font-weight:700;
    font-size:13px;
  }
  .langToggle{
    display:flex;
    gap:8px;
  }
  .langToggle button{
    border:1px solid var(--stroke);
    background:rgba(255,255,255,.70);
    padding:8px 12px;
    border-radius:999px;
    cursor:pointer;
    font-weight:800;
    color:rgba(26,29,43,.80);
  }
  .langToggle button.active{
    background:rgba(26,29,43,.92);
    color:#fff;
    border-color:rgba(26,29,43,.12);
  }

  .grid{
    display:grid;
    grid-template-columns: 380px 1fr;
    gap:18px;
    align-items:start;
    margin-top:18px;
  }
  @media (max-width: 980px){
    .grid{ grid-template-columns:1fr; }
  }

  .panel{
    background:rgba(255,255,255,.70);
    border:1px solid var(--stroke);
    border-radius:22px;
    box-shadow: var(--shadow);
    overflow:hidden;
  }
  .panel .inner{
    padding:18px 18px 16px;
  }
  .panel h2{
    font-size:18px;
    margin:0 0 8px;
    letter-spacing:.2px;
  }
  .hint{
    margin:0 0 14px;
    font-size:12.5px;
    color:rgba(26,29,43,.62);
    line-height:1.45;
  }

  .row2{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:12px;
  }
  .row1{
    display:grid;
    grid-template-columns:1fr;
    gap:12px;
  }

  label{
    display:block;
    font-size:12px;
    font-weight:800;
    color:rgba(26,29,43,.72);
    margin-bottom:6px;
  }
  input, select, textarea{
    width:100%;
    padding:12px 12px;
    border-radius:14px;
    border:1px solid rgba(26,29,43,.14);
    background:rgba(255,255,255,.85);
    outline:none;
    font-size:14px;
    color:rgba(26,29,43,.92);
  }
  input:disabled{
    opacity:.75;
    background:rgba(245,245,245,.9);
    cursor:not-allowed;
  }

  .btnRow{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    margin-top:12px;
  }
  .btn{
    border:1px solid var(--stroke);
    padding:11px 12px;
    border-radius:14px;
    cursor:pointer;
    font-weight:900;
    background:rgba(255,255,255,.78);
    box-shadow:0 10px 24px rgba(0,0,0,.06);
    transition: transform .08s ease;
    user-select:none;
  }
  .btn:active{ transform: translateY(1px); }
  .btn.primary{
    background: linear-gradient(135deg, rgba(251,113,133,.28), rgba(96,165,250,.20));
    border-color:rgba(26,29,43,.10);
  }
  .btn.secondary{
    background: linear-gradient(135deg, rgba(52,211,153,.22), rgba(255,226,185,.30));
    border-color:rgba(26,29,43,.10);
  }
  .btn.ghost{
    background:rgba(255,255,255,.70);
  }

  .privacy{
    font-size:12px;
    color:rgba(26,29,43,.62);
    margin-top:10px;
    line-height:1.45;
  }

  /* celestial sigil in left panel */
.treeBox{
  display:flex;
  justify-content:center;
  padding:10px 0 14px;
}

.miniSigilWrap{
  width:160px;
  height:210px;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:10px;
  text-align:center;
}

.miniSigil{
  width:150px;
  height:150px;
  border-radius:999px;
  position:relative;
  border:1px solid rgba(26,29,43,.10);
  background:
    radial-gradient(85px 70px at 35% 25%, rgba(255,255,255,.95), transparent 60%),
    radial-gradient(120px 110px at 70% 35%, rgba(251,113,133,.20), transparent 70%),
    radial-gradient(140px 130px at 35% 75%, rgba(52,211,153,.18), transparent 72%),
    radial-gradient(140px 130px at 75% 80%, rgba(96,165,250,.18), transparent 72%),
    linear-gradient(135deg, rgba(255,255,255,.72), rgba(255,255,255,.42));
  box-shadow:
    0 18px 55px rgba(0,0,0,.10),
    inset 0 1px 0 rgba(255,255,255,.55);
}

.miniSigilDash{
  position:absolute;
  inset:12px;
  border-radius:999px;
  border:1px dashed rgba(26,29,43,.18);
  opacity:.65;
}

.miniSigilStar{
  position:absolute;
  top:10px;
  left:50%;
  transform:translateX(-50%);
  font-size:14px;
  color:rgba(26,29,43,.45);
  opacity:.85;
}

.miniSigilLabel{
  width:100%;             
  justify-content:center;     
  text-align:center;           
  font-size:11px;
  font-weight:900;
  letter-spacing:.22em;
  color:rgba(26,29,43,.55);
  display:flex;
  align-items:center;
  gap:10px;
  user-select:none;
}

.miniSigilSpark{
  display:inline-flex;     
  width:14px;                 
  justify-content:center;     
  font-size:12px;
  color:rgba(26,29,43,.50);
}

  /* right content */
  .rightTop{
    display:flex;
    justify-content:space-between;
    align-items:flex-start;
    gap:14px;
    padding:18px 18px 0;
  }
  .rightTop h2{ margin:0; }
  .rightTop .subhint{
    font-size:12.5px;
    color:rgba(26,29,43,.62);
    margin-top:4px;
  }

  .chips{
    display:flex;
    flex-wrap:wrap;
    gap:8px;
    padding:12px 18px 10px;
  }
  .chip{
    font-size:12px;
    font-weight:800;
    color:rgba(26,29,43,.75);
    padding:7px 10px;
    border-radius:999px;
    border:1px solid rgba(26,29,43,.12);
    background:rgba(255,255,255,.70);
  }

  /* cards spread */
  .cards{
    display:grid;
    grid-template-columns: repeat(3, minmax(210px, 1fr));
    gap:12px;
    padding:8px 14px 14px;
    overflow:visible;
    padding-bottom: 26px;
  }
  @media (max-width: 980px){
    .cards{ grid-template-columns:1fr; }
  }

  .spreadTag{
    display:flex;
    align-items:center;
    justify-content:flex-end;
    gap:8px;
    font-size:12.5px;
    color:rgba(26,29,43,.62);
    padding:0 18px 10px;
  }
  .spreadTag .tagPill{
    border:1px solid rgba(26,29,43,.12);
    background:rgba(255,255,255,.70);
    border-radius:999px;
    padding:6px 10px;
    font-weight:900;
  }

  /* ===== Flip card (dynamic height via --flipH) ===== */
  .flip{
    perspective: 1200px;
    min-height: var(--flipH);
  }
  .flipInner{
    position:relative;
    width:100%;
    height: var(--flipH);
    transform-style:preserve-3d;
    transition: transform .9s cubic-bezier(.2,.7,.1,1);
  }
  .flip.revealed .flipInner{ transform: rotateY(180deg); }

  .face{
    position:absolute;
    inset:0;
    border-radius:22px;
    border:1px solid rgba(26,29,43,.12);
    backface-visibility:hidden;
    overflow:hidden;
    box-shadow: 0 16px 44px rgba(0,0,0,.10);
    background:rgba(255,255,255,.78);
  }
  .face.back{
    display:flex;
    align-items:center;
    justify-content:center;
  }
  .pattern{
    width:100%;
    height:100%;
    background:
      radial-gradient(circle at 20% 20%, rgba(251,113,133,.20), transparent 45%),
      radial-gradient(circle at 70% 30%, rgba(96,165,250,.20), transparent 45%),
      radial-gradient(circle at 50% 80%, rgba(52,211,153,.18), transparent 50%),
      linear-gradient(135deg, rgba(255,255,255,.85), rgba(255,255,255,.65));
  }
  .face.front{
    transform: rotateY(180deg);
    display:flex;
    flex-direction:column;
  }

  .frontTop{
    display:flex;
    justify-content:space-between;
    gap:10px;
    padding:12px 12px 0;
    flex-wrap:wrap;
    row-gap:8px;
  }

  .art{
    display:flex;
    justify-content:center;
    align-items:center;
    padding:10px 12px 6px;
    flex:1 1 auto;
    overflow:visible;
  }
  .art img{
    width:160px;
    height:auto;
    max-height:250px;
    border-radius:18px;
    border:1px solid rgba(26,29,43,.10);
    box-shadow: 0 14px 28px rgba(0,0,0,.10);
    object-fit:cover;
    background:rgba(255,255,255,.70);
  }

  .frontBody{
    padding:10px 14px 14px;
    border-top:1px solid rgba(26,29,43,.08);
    background:rgba(255,255,255,.76);
  }
  .name{
    font-size:18px;
    font-weight:950;
    margin-bottom:6px;
  }
  .meaning{
    margin:0;
    font-size:12px;
    color:rgba(26,29,43,.65);
    line-height:1.45;
  }

  @media (max-width: 520px){
    :root{ --flipH: 560px; }
    .art img{ max-height: 220px; }
  }

  /* reading box */
  .reading{
    margin:0 18px 18px;
    border-radius:20px;
    border:1px solid rgba(26,29,43,.10);
    background:rgba(255,255,255,.72);
    box-shadow:0 14px 36px rgba(0,0,0,.08);
    overflow:hidden;
  }
  .reading .inner{ padding:16px 16px 14px; }
  .section{
    padding:12px 12px;
    border-radius:16px;
    border:1px solid rgba(26,29,43,.08);
    background:rgba(255,255,255,.72);
    margin-bottom:10px;
  }
  .secTitle{
    font-weight:950;
    margin-bottom:8px;
    font-size:13px;
    color:rgba(26,29,43,.80);
  }
  .p{
    font-size:13.5px;
    color:rgba(26,29,43,.72);
    line-height:1.55;
  }
  ul{ margin:8px 0 0 18px; padding:0; }
  li{ margin:6px 0; }

  .disclaimer{
    padding:0 18px 16px;
    color:rgba(26,29,43,.60);
    font-size:12.5px;
    line-height:1.45;
  }

  /* share card */
  .shareWrap{
    margin:0 18px 18px;
    border-radius:22px;
    overflow:hidden;
    border:1px solid rgba(26,29,43,.10);
    background:rgba(255,255,255,.78);
    box-shadow:0 18px 50px rgba(0,0,0,.10);
  }
  .shareHeader{
    display:flex;
    justify-content:space-between;
    gap:12px;
    padding:14px 14px 10px;
    align-items:flex-start;
    border-bottom:1px solid rgba(26,29,43,.08);
  }
  .shareTitle{
    font-weight:1000;
    font-size:16px;
    margin:0;
  }
  .shareMeta{
    font-size:12.5px;
    color:rgba(26,29,43,.60);
    margin-top:4px;
  }
  .shareBody{
    display:grid;
    grid-template-columns: 210px 1fr;
    gap:12px;
    padding:12px 14px 14px;
    align-items:start;
  }
  @media (max-width: 980px){
    .shareBody{ grid-template-columns:1fr; }
  }

  .shareTree{
    width:190px;
    height:230px;
    position:relative;
    border-radius:18px;
    border:1px solid rgba(26,29,43,.10);
    background:
      radial-gradient(200px 140px at 40% 20%, rgba(255,255,255,.80), transparent 65%),
      linear-gradient(135deg, rgba(255,255,255,.75), rgba(255,255,255,.55));
    overflow:hidden;
  }
  .shareTree::after{
    content:"";
    position:absolute;
    inset:-20px;
    background: radial-gradient(240px 180px at 45% 35%, var(--treeGlow), transparent 68%);
    pointer-events:none;
  }
  .shareTree .star{
    position:absolute;
    top:10px; left:50%;
    transform:translateX(-50%);
    color:var(--treeStar);
    text-shadow: 0 0 26px var(--treeStarGlow);
    font-size:30px;
    z-index:2;
  }
  .shareTree .layer{
    position:absolute;
    left:50%;
    transform:translateX(-50%);
    border-radius:999px;
    background: linear-gradient(135deg, var(--treeA), var(--treeB));
    z-index:1;
  }
  .shareTree .l1{ width:150px; height:60px; top:52px; }
  .shareTree .l2{ width:125px; height:56px; top:96px; opacity:.98; }
  .shareTree .l3{ width:98px; height:52px; top:136px; opacity:.98; }
  .shareTree .trunk{
    position:absolute;
    width:48px; height:30px;
    background: linear-gradient(135deg, #c08457, #9a5b2d);
    border-radius:12px;
    left:50%; transform:translateX(-50%);
    top:182px;
    z-index:1;
  }

  .ornaments{ position:absolute; inset:0; pointer-events:none; z-index:3; }
  .orn{
    position:absolute;
    font-size:16px;
    filter: drop-shadow(0 6px 10px rgba(0,0,0,.15));
    animation: floaty 2.6s ease-in-out infinite;
    opacity: .95;
  }
  .orn.small{ font-size:14px; opacity:.9; }
  .orn.big{ font-size:18px; }
  @keyframes floaty{
    0%,100%{ transform: translateY(0); }
    50%{ transform: translateY(-3px); }
  }

  .shareTextBox{
    border-radius:18px;
    border:1px solid rgba(26,29,43,.10);
    background:rgba(255,255,255,.74);
    padding:12px 12px;
    min-height:230px;
    white-space:pre-wrap;
    font-size:12.8px;
    color:rgba(26,29,43,.72);
    line-height:1.45;
  }

  /* toast */
  .toast{
    position:fixed;
    bottom:18px;
    left:50%;
    transform:translateX(-50%);
    background:rgba(26,29,43,.92);
    color:#fff;
    padding:10px 14px;
    border-radius:999px;
    font-weight:900;
    font-size:13px;
    opacity:0;
    pointer-events:none;
    transition: opacity .25s ease, transform .25s ease;
    box-shadow:0 18px 40px rgba(0,0,0,.20);
    z-index:9999;
  }
  .toast.show{
    opacity:1;
    transform:translateX(-50%) translateY(-4px);
  }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <h1 id="title">âœ¨ New Year Divination, 2026</h1>
      <p class="subtitle" id="subtitle">
        The year's close offers a sacred pause. We invite you to reflect by the warmth of the Yule hearth and cast your deepest hopes upon the cards. The generated reading will illuminate the purpose and prophecy awaiting you in 2026, based on just 3-5 keywords for where you stand today, and what you seek for tomorrow.
      </p>
      <div class="topbar">
        <div class="pill" id="statusPill">ğŸŒŸ Ready</div>
        <div class="langToggle">
          <button id="btnEN" type="button" class="active">EN</button>
          <button id="btnZH" type="button">ä¸­æ–‡</button>
        </div>
      </div>
    </header>

    <div class="grid">
      <!-- LEFT: form -->
      <div class="panel">
        <div class="inner">
          <div class="treeBox" aria-hidden="true">
            <div class="miniSigilWrap">
              <div class="miniSigil">
                <div class="miniSigilDash"></div>
                <div class="miniSigilStar">âœ§</div>
              </div>

              <div class="miniSigilLabel">
                <span class="miniSigilSpark">âœ¦</span>
                HOLIDAY TAROT
                <span class="miniSigilSpark">âœ¦</span>
              </div>
            </div>
          </div>

          <h2 id="promptTitle">Your info</h2>
          <p class="hint" id="promptHint">
            Words should be comma separated. After you generate once, the 2025 words will lock to keep the past stable.
          </p>

          <div class="row2">
            <div>
              <label id="lblName" for="name">Name (optional)</label>
              <input id="name" placeholder="Apple"/>
            </div>
            <div>
              <label id="lblAge" for="age">Age</label>
              <input id="age" inputmode="numeric" placeholder="25"/>
            </div>
          </div>

          <div class="row2" style="margin-top:12px;">
            <div>
              <label id="lblMbti" for="mbti">MBTI (optional)</label>
              <input id="mbti" placeholder="INTP/ENFP"/>
            </div>
            <div>
              <label id="lblZodiac" for="zodiac">Constellation</label>
              <select id="zodiac" required>
                <option value="">Select your constellation</option>
                <option value="aries">Ariesï¼ˆç™½ç¾Šåº§ï¼‰</option>
                <option value="taurus">Taurusï¼ˆé‡‘ç‰›åº§ï¼‰</option>
                <option value="gemini">Geminiï¼ˆåŒå­åº§ï¼‰</option>
                <option value="cancer">Cancerï¼ˆå·¨èŸ¹åº§ï¼‰</option>
                <option value="leo">Leoï¼ˆç‹®å­åº§ï¼‰</option>
                <option value="virgo">Virgoï¼ˆå¤„å¥³åº§ï¼‰</option>
                <option value="libra">Libraï¼ˆå¤©ç§¤åº§ï¼‰</option>
                <option value="scorpio">Scorpioï¼ˆå¤©èåº§ï¼‰</option>
                <option value="sagittarius">Sagittariusï¼ˆå°„æ‰‹åº§ï¼‰</option>
                <option value="capricorn">Capricornï¼ˆæ‘©ç¾¯åº§ï¼‰</option>
                <option value="aquarius">Aquariusï¼ˆæ°´ç“¶åº§ï¼‰</option>
                <option value="pisces">Piscesï¼ˆåŒé±¼åº§ï¼‰</option>
              </select>
            </div>
          </div>

          <div class="row1" style="margin-top:12px;">
            <div>
              <label id="lblSelf" for="selfWords">3â€“5 words: you in 2025</label>
              <input id="selfWords" placeholder="e.g., tired, hard-working, growth"/>
            </div>
            <div>
              <label id="lblHope" for="hopeWords">3â€“5 words: your 2026 hopes</label>
              <input id="hopeWords" placeholder="e.g., health, clarity, self-care"/>
            </div>
            <div>
              <label id="lblGoal" for="goal">Most important 2026 goal</label>
              <select id="goal">
                <option value="career">career</option>
                <option value="love">love</option>
                <option value="family">family</option>
                <option value="health">health</option>
                <option value="money">money</option>
                <option value="self-growth">self-growth</option>
                <option value="creativity">creativity</option>
                <option value="adventure">adventure</option>
              </select>
            </div>
          </div>

          <div class="btnRow">
            <button class="btn primary" type="button" id="drawBtn">ğŸ´ Draw & reveal</button>
            <button class="btn secondary" type="button" id="surpriseBtn">ğŸ Surprise</button>
            <button class="btn ghost" type="button" id="downloadBtn">ğŸ–¼ï¸ Download card</button>
            <button class="btn ghost" type="button" id="resetBtn">â†© Reset</button>
          </div>

          <div class="privacy" id="privacyNote">
            Note: This page runs locally in your browser.
          </div>

          <div style="
            margin-top: 24px;
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 8px;
            background-color: #f7f7f7;
          ">
            <div class="input-section">
                <h4 class="section-title" id="oracleTitle">ğŸ”® Yes/No Oracle </h4>
                <p class="description" id="oracleDescription">Think of a "Yes/No" question, enter a number you like, and let the "Dice of Fate" guide you.</p>

                <div class="oracle-input-group" style="display: flex; gap: 10px; margin-top: 10px; align-items: center;">
                    <input type="number" id="oracleInputNumber" min="1" max="99" placeholder="Enter a number 1-99" oninput="limitInput(this)" style="flex-grow: 1; padding: 8px;">
                    <button id="oracleRollButton" type="button" class="btn secondary">Get Answer</button>
                </div>

                <div id="oracleResult" class="oracle-result-box" style="min-height: 20px; margin-top: 10px; padding: 5px;"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="panel">
        <div class="rightTop">
          <div>
            <h2 id="spreadTitle">Your 3-card spread</h2>
            <div class="subhint" id="spreadHint">Past â†’ Present â†’ Future</div>
          </div>
          <div class="spreadTag">
            <div class="tagPill" id="spreadTag">Not drawn yet</div>
          </div>
        </div>

        <div class="chips" id="chips"></div>
        <div class="cards" id="cards"></div>

        <div class="reading">
          <div class="inner">
            <h2 id="readingTitle" style="margin:0 0 10px;">âœ¨ Your reading</h2>
            <div id="readingContent"></div>
          </div>
          <div class="disclaimer" id="disclaimer"></div>
        </div>

        <div class="shareWrap" id="shareCard">
          <div class="shareHeader">
            <div>
              <p class="shareTitle" id="shareTitle" style="margin:0;">Holiday Tarot 2026</p>
              <div class="shareMeta" id="shareMeta">Ready to draw.</div>
            </div>
          </div>
          <div class="shareBody">
            <div class="shareTree" id="shareTree">
              <div class="star">â­</div>
              <div class="layer l1"></div>
              <div class="layer l2"></div>
              <div class="layer l3"></div>
              <div class="trunk"></div>
              <div class="ornaments" id="ornaments"></div>
            </div>
            <div class="shareTextBox" id="shareBody"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast">Saved!</div>

  <script>
/* =========================================================
   CONFIG
   ========================================================= */
const REAL_TAROT_IMAGES = false;

/* =========================================================
   i18n
   ========================================================= */
let LANG = "en";
const t = {
  en: {
    title: "âœ¨ New Year Divination",
    subtitle: "The year's close offers a sacred pause. We invite you to reflect by the warmth of the Yule hearth and cast your deepest hopes upon the cards. The generated reading will illuminate the purpose and prophecy awaiting you in 2026, based on just 3-5 keywords for where you stand today, and what you seek for tomorrow.",
    ready: "ğŸŒŸ Ready",
    promptTitle: "Your info",
    promptHint: "Words should be comma separated. After you generate once, the 2025 words will be locked.",
    name: "Name (optional)",
    age: "Age",
    mbti: "MBTI (optional)",
    zodiac: "Constellation",
    zodiacPlaceholder: "Select your constellation",
    self: "3â€“5 words: you in 2025",
    hope: "3â€“5 words: your 2026 hopes",
    goal: "Most important 2026 goal",
    draw: "ğŸ´ Draw & reveal",
    surprise: "ğŸ Random",
    download: "ğŸ–¼ï¸ Download card",
    reset: "â†© Reset",
    privacy: "Note: This page runs locally in your browserâ€”nothing is uploaded.",
    spreadTitle: "Your 3-card spread",
    spreadHint: "Past â†’ Present â†’ Future",
    notDrawn: "Not drawn yet",
    readingTitle: "âœ¨ Your reading",
    disclaimer: "Tarot is for reflection and vibes, not guaranteed outcomes. Keep what resonates; skip what doesnâ€™t.",
    needAge: "Please enter your age (a number).",
    needWords: "Use 3â€“5 words in each keywords box.",
    needZodiac: "Please select your constellation.",
    locked: "ğŸ”’ 2025 words are locked (Reset to edit).",
    generated: "âœ¨ Reading generated",
    shareReady: "Ready to draw.",
    shareGenerated: "Card of Power and Guidance",
    downloading: "ğŸ–¼ï¸ Creating imageâ€¦",
    saved: "âœ… Saved!",
    downloadFail: "Couldnâ€™t generate image. Try again (Chrome recommended).",
    oracleTitle: "ğŸ”® Yes/No Oracle",
    oracleDescription: "Think of a 'Yes/No' question, enter a number you like, and let the 'Dice of Fate' guide you.",
    oraclePlaceholder: "1-99",
    oracleButton: "ğŸ”",
    oracleError: "Please enter a valid number between 1 and 99.",
    oracleStrongYes: "âœ… Strong YES: Your wish is affirmed by the universe. Act decisively!",
    oracleYesEffort: "ğŸŸ¡ Yes, with effort: The direction is right, but requires focus and patience.",
    oracleNoReconsider: "ğŸŸ  No, reconsider: The timing may be off, or your approach needs modification.",
    oracleNotAdvised: "âŒ Not Advised: Wait for a clearer signal. Now is not the best time to act."
  },
  zh: {
    title: "âœ¨ æ–°å¹´å¡”ç½—å åœ",
    subtitle: "å¹´åº•äº†ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆé€‚åˆåœä¸‹æ¥æ€è€ƒçš„æ—¶åˆ»ã€‚å’±ä»¬å°±ç€ç‚‰ç«çš„æ¸©æš–ï¼Œå¥½å¥½å†…è§‚ä¸€ä¸‹è‡ªå·±ï¼ŒæŠŠä½ å¯¹æ¥å¹´æœ€æ·±çš„æœŸå¾…ï¼Œé€šè¿‡å¡ç‰ŒæŠ•å°„å‡ºæ¥ã€‚è¿™ä»½è§£è¯»ä¼šå¸®ä½ çœ‹åˆ°26å¹´çš„é‡ç‚¹å’Œæ–¹å‘ï¼Œåªéœ€è¦ä½ ç”¨3åˆ°5ä¸ªè¯ï¼Œæè¿°ä¸€ä¸‹ã€Œä»Šå¤©çš„ä½ ã€ä»¥åŠã€Œæ˜å¤©æƒ³æˆä¸ºçš„ä½ ã€ã€‚",
    ready: "ğŸŒŸ å‡†å¤‡å¥½äº†",
    promptTitle: "ä½ çš„ä¿¡æ¯",
    promptHint: "å…³é”®è¯ç”¨é€—å·åˆ†éš”ã€‚ç”Ÿæˆä¸€æ¬¡åï¼Œ2025 çš„å…³é”®è¯ä¼šé”å®šã€‚",
    name: "åå­—ï¼ˆå¯é€‰ï¼‰",
    age: "å¹´é¾„",
    mbti: "MBTIï¼ˆå¯é€‰ï¼‰",
    zodiac: "æ˜Ÿåº§",
    zodiacPlaceholder: "è¯·é€‰æ‹©æ˜Ÿåº§",
    self: "3â€“5 ä¸ªè¯ï¼š2025 çš„ä½ ",
    hope: "3â€“5 ä¸ªè¯ï¼šå¯¹ 2026 çš„æœŸå¾…",
    goal: "2026 æœ€é‡è¦çš„ç›®æ ‡",
    draw: "ğŸ´ æŠ½ç‰Œå¹¶ç¿»å¼€",
    surprise: "ğŸ éšæœºç¤ºä¾‹",
    download: "ğŸ–¼ï¸ ä¸‹è½½å›¾ç‰‡å¡",
    reset: "â†© é‡ç½®",
    privacy: "æç¤ºï¼šé¡µé¢åªåœ¨æµè§ˆå™¨æœ¬åœ°è¿è¡Œï¼Œä¸ä¼šä¸Šä¼ ä½ çš„ä¿¡æ¯ã€‚",
    spreadTitle: "ä½ çš„ä¸‰å¼ ç‰Œé˜µ",
    spreadHint: "ä»è¿‡å» â†’ ç°åœ¨ â†’ æœªæ¥",
    notDrawn: "è¿˜æ²¡æŠ½ç‰Œ",
    readingTitle: "è§£è¯»",
    disclaimer: "å¡”ç½—çš„æ„ä¹‰åœ¨äºå†…è§‚è‡ªçœã€æ•æ‰çµæ„Ÿï¼Œç»“æœä»…ä¾›å‚è€ƒã€‚è¯·å¬ä»ä½ å†…å¿ƒæ·±å¤„çš„å…±é¸£ï¼Œå°†å…¶ä½œä¸ºä¸€ä»½æŒ‡å¼•å°±å¥½ã€‚",
    needAge: "è¯·å¡«å†™å¹´é¾„ï¼ˆæ•°å­—ï¼‰ã€‚",
    needWords: "ä¸¤æ å…³é”®è¯éƒ½éœ€è¦3â€“5ä¸ªè¯ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰ã€‚",
    needZodiac: "è¯·é€‰æ‹©ä½ çš„æ˜Ÿåº§ã€‚",
    locked: "ğŸ”’ 25å¹´å…³é”®è¯å·²é”å®šï¼ˆé‡ç½®åå¯ç¼–è¾‘ï¼‰",
    generated: "âœ¨ å·²ç”Ÿæˆè§£è¯»",
    shareReady: "å‡†å¤‡æŠ½ç‰Œã€‚",
    shareGenerated: "åŠ›é‡æŒ‡å¼•å¡",
    downloading: "ğŸ–¼ï¸ æ­£åœ¨ç”Ÿæˆå›¾ç‰‡â€¦",
    saved: "âœ… å·²ä¿å­˜ï¼",
    downloadFail: "ç”Ÿæˆå›¾ç‰‡å¤±è´¥ã€‚å»ºè®®ç”¨Chromeå†è¯•ä¸€æ¬¡ã€‚",
    oracleTitle: "ğŸ”® æ˜¯/å¦ å¿«é€ŸæŒ‡å¼•",
    oracleDescription: "åœ¨å¿ƒä¸­é»˜æƒ³ä¸€ä¸ªâ€œæ˜¯/å¦â€é—®é¢˜ï¼Œå¹¶è¾“å…¥ä¸€ä¸ªæ‚¨å¿ƒä»ªçš„æ•°å­—ï¼Œè®©â€œå‘½è¿éª°å­â€ä¸ºæ‚¨æ­ç¤ºç­”æ¡ˆã€‚",
    oraclePlaceholder: "1-99",
    oracleButton: "ğŸ”",
    oracleError: "è¯·è¾“å…¥ 1 åˆ° 99 ä¹‹é—´çš„æœ‰æ•ˆæ•°å­—ã€‚",
    oracleStrongYes: "âœ… å¼ºåŠ›æ”¯æŒï¼šä½ çš„æ„¿æœ›å·²è·å®‡å®™çš„è‚¯å®šï¼Œè¯·æœæ–­è¡ŒåŠ¨ï¼",
    oracleYesEffort: "âš ï¸ æ˜¯ï¼Œä½†éœ€åŠªåŠ›ï¼šæ–¹å‘æ˜¯å¯¹çš„ï¼Œä½†éœ€è¦ä½ ä»˜å‡ºä¸“æ³¨å’Œè€å¿ƒã€‚",
    oracleNoReconsider: "ğŸŸ§ å¦ï¼Œéœ€é‡æ€ï¼šæ—¶æœºå¯èƒ½ä¸å¯¹ï¼Œæˆ–éœ€è¦ä¿®æ”¹ä½ çš„æé—®æˆ–æ–¹æ³•ã€‚",
    oracleNotAdvised: "âŒ æš‚ä¸å»ºè®®ï¼šè¯·ç­‰å¾…æ›´æ˜ç¡®çš„ä¿¡å·ï¼Œç°åœ¨ä¸æ˜¯é‡‡å–è¡ŒåŠ¨çš„æœ€ä½³æ—¶æœºã€‚"
  }
};

/* =========================================================
   STATE + REFS
   ========================================================= */
const STATE = {
  drawn:false,
  lockedSelf:false,
  cards:[],
  profile:null,
  theme:{ color:"green", vibe:"soft" }
};

const toast = document.getElementById("toast");
const statusPill = document.getElementById("statusPill");
const spreadTag = document.getElementById("spreadTag");
const cardsEl = document.getElementById("cards");
const chipsEl = document.getElementById("chips");
const readingContent = document.getElementById("readingContent");
const shareBody = document.getElementById("shareBody");
const shareMeta = document.getElementById("shareMeta");
const ornamentsEl = document.getElementById("ornaments");

const nameInput = document.getElementById("name");
const ageInput = document.getElementById("age");
const mbtiInput = document.getElementById("mbti");
const zodiacSelect = document.getElementById("zodiac");
const selfInput = document.getElementById("selfWords");
const hopeInput = document.getElementById("hopeWords");
const goalSelect = document.getElementById("goal");

/* =========================================================
   HELPERS
   ========================================================= */
function showToast(msg){
  toast.textContent = msg;
  toast.classList.add("show");
  setTimeout(()=>toast.classList.remove("show"), 2800);
}
function normalizeWords(s){
  return (s || "").replace(/[â€¢|/]/g, " ").replace(/\s+/g, " ").trim();
}
function parseWords(s){
  const tt = normalizeWords(s);
  if(!tt) return [];
  const parts = tt.includes(",") ? tt.split(",") : tt.split(" ");
  return parts.map(x=>x.trim()).filter(Boolean).slice(0,5);
}
function validateRange(arr){ return arr.length >= 3 && arr.length <= 5; }
function cap(s){ return s ? (s[0].toUpperCase() + s.slice(1)) : s; }
function clampAge(age){
  if(!Number.isFinite(age)) return null;
  return Math.max(10, Math.min(100, age));
}
function pickFrom(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

/* =========================================================
   LANGUAGE SWITCH
   ========================================================= */
function setLang(lang){
  LANG = lang;
  document.getElementById("btnEN").classList.toggle("active", lang==="en");
  document.getElementById("btnZH").classList.toggle("active", lang==="zh");
  document.documentElement.lang = (LANG==="zh" ? "zh" : "en");

  const L = t[LANG];
  document.getElementById("title").textContent = L.title;
  document.getElementById("subtitle").textContent = L.subtitle;
  document.getElementById("statusPill").textContent = STATE.drawn ? L.generated : L.ready;

  document.getElementById("promptTitle").textContent = L.promptTitle;
  document.getElementById("promptHint").textContent = L.promptHint;

  document.getElementById("lblName").textContent = L.name;
  document.getElementById("lblAge").textContent = L.age;
  document.getElementById("lblMbti").textContent = L.mbti;
  document.getElementById("lblZodiac").textContent = L.zodiac;
  document.querySelector("#zodiac option[value='']").textContent = L.zodiacPlaceholder;

  document.getElementById("lblSelf").textContent = L.self;
  document.getElementById("lblHope").textContent = L.hope;
  document.getElementById("lblGoal").textContent = L.goal;

  document.getElementById("drawBtn").textContent = L.draw;
  document.getElementById("surpriseBtn").textContent = L.surprise;
  document.getElementById("downloadBtn").textContent = L.download;
  document.getElementById("resetBtn").textContent = L.reset;

  document.getElementById("privacyNote").textContent = L.privacy;
  document.getElementById("spreadTitle").textContent = L.spreadTitle;
  document.getElementById("spreadHint").textContent = L.spreadHint;
  document.getElementById("readingTitle").textContent = L.readingTitle;

  // Oracle texts update
  document.getElementById("oracleTitle").textContent = L.oracleTitle;
  document.getElementById("oracleDescription").textContent = L.oracleDescription;
  document.getElementById("oracleInputNumber").placeholder = L.oraclePlaceholder;
  document.getElementById("oracleRollButton").textContent = L.oracleButton;

  if(!STATE.drawn){
    document.getElementById("spreadTag").textContent = L.notDrawn;
    document.getElementById("shareMeta").textContent = L.shareReady;
    document.getElementById("shareTitle").textContent = (LANG==="zh" ? "2026 å¡”ç½—å›¾ç‰‡å¡" : "Holiday Tarot 2026");
    document.getElementById("disclaimer").textContent = "";
    document.getElementById("readingContent").innerHTML = "";
    document.getElementById("shareBody").textContent = "";
  } else {
    renderAll();
  }
}

document.getElementById("btnEN").addEventListener("click", ()=>setLang("en"));
document.getElementById("btnZH").addEventListener("click", ()=>setLang("zh"));

/* =========================================================
   ORACLE
   ========================================================= */
function limitInput(element) {
  if (element.value < 1) element.value = 1;
  if (element.value > 99) element.value = 99;
}
function generateOracleResult() {
  const inputEl = document.getElementById("oracleInputNumber");
  const resultEl = document.getElementById("oracleResult");
  const userNumber = parseInt(inputEl.value, 10);

  if (isNaN(userNumber) || userNumber < 1 || userNumber > 99) {
    resultEl.innerHTML = `<span style="color: red;">${t[LANG].oracleError}</span>`;
    return;
  }

  const randomNumber = Math.floor(Math.random() * 100) + 1;
  const total = userNumber + randomNumber;
  const remainder = total % 5;

  let resultText = "";
  let styleColor = "";

  if (remainder === 0 || remainder === 1) {
    resultText = t[LANG].oracleStrongYes;
    styleColor = "#10b981";
  } else if (remainder === 2) {
    resultText = t[LANG].oracleYesEffort;
    styleColor = "#f59e0b";
  } else if (remainder === 3) {
    resultText = t[LANG].oracleNoReconsider;
    styleColor = "#f97316";
  } else {
    resultText = t[LANG].oracleNotAdvised;
    styleColor = "#ef4444";
  }

  resultEl.innerHTML = `<span style="font-weight: bold; color: ${styleColor};">${resultText}</span>`;
}

/* =========================================================
   TAROT DECK + EVERYTHING ELSE
   (Your original logic below is unchanged except one tiny fix in renderAll)
   ========================================================= */
const deck = [
  { nameEN:"The Star", nameZH:"æ˜Ÿæ˜Ÿ", vibeEN:"Hope & renewal", vibeZH:"å¸Œæœ›ä¸å¤è‹",
    baseEN:"Gentle healing is underway. Believe in the long-range vision and move forward with quiet confidence.",
    baseZH:"å†…å¿ƒæ­£åœ¨æ‚„ç„¶æ„ˆåˆï¼Œå……æ»¡å¸Œæœ›ã€‚ç›¸ä¿¡ä½ çš„é•¿è¿œæ„¿æ™¯ï¼Œå¸¦ç€è¿™ä»½å®é™çš„è‡ªä¿¡å‘å‰è¿ˆè¿›ã€‚",
    imgReal:"images/star.jpg" },
  { nameEN:"The Sun", nameZH:"å¤ªé˜³", vibeEN:"Joy & clarity", vibeZH:"å–œæ‚¦ä¸çœŸæˆ‘",
    baseEN:"Feel the warmth of success and be visible. Authentic clarity overpowers frantic effort.",
    baseZH:"å……æ»¡è‡ªä¿¡ä¸æ´»åŠ›ï¼Œäº«å—è¢«çœ‹è§ã€‚å¿ äºçœŸæˆ‘çš„æ¸…æ™°ç›®æ ‡ï¼Œè¿œèƒœäºç›²ç›®è¿½é€ã€‚",
    imgReal:"images/sun.jpg" },
  { nameEN:"The Fool", nameZH:"æ„šè€…", vibeEN:"Fresh start", vibeZH:"æ–°çš„å¼€å§‹",
    baseEN:"Take a brave leap into the unknown. The time for learning is nowâ€”don't wait for perfection.",
    baseZH:"å‹‡æ•¢åœ°è¿ˆå‡ºç¬¬ä¸€æ­¥ã€‚æ­¤åˆ»å°±æ˜¯å­¦ä¹ çš„æœ€ä½³æ—¶æœºï¼Œæ”¾ä¸‹å¯¹å®Œç¾çš„è‹›æ±‚ï¼Œåœ¨å®è·µä¸­æ¢ç´¢ã€‚",
    imgReal:"images/fool.jpg" },
  { nameEN:"The High Priestess", nameZH:"å¥³ç¥­å¸", vibeEN:"Inner knowing", vibeZH:"ç›´è§‰ä¸æ´å¯Ÿ",
    baseEN:"Trust your intuition and access hidden wisdom. Create space to hear the quiet, vital data within.",
    baseZH:"ç›¸ä¿¡ä½ çš„ç›´è§‰ï¼Œå†…åœ¨çš„æ™ºæ…§æ­£åœ¨æ˜¾ç°ã€‚éš”ç»å¤–ç•Œå¹²æ‰°ï¼Œæ•æ‰å†…å¿ƒæ·±å¤„æœ€é‡è¦çš„ä¿¡å·ã€‚",
    imgReal:"images/high_priestess.jpg" },
  { nameEN:"The Empress", nameZH:"å¥³çš‡", vibeEN:"Growth & nurture", vibeZH:"ä¸°ç››ä¸æ»‹å…»",
    baseEN:"Abundance flows from self-care and creativity. Build sustainable routines that truly nourish your life.",
    baseZH:"ä¸°ç››æºäºè‡ªæˆ‘å…³çˆ±ä¸åˆ›é€ åŠ›ã€‚å»ºç«‹ä¸€å¥—çœŸæ­£æ»‹å…»ä½ èº«å¿ƒçš„æ—¥å¸¸ä¹ æƒ¯ï¼Œæ„Ÿå—ä¸‡ç‰©çš„ç”Ÿé•¿ã€‚",
    imgReal:"images/empress.jpg" },
  { nameEN:"The Magician", nameZH:"é­”æœ¯å¸ˆ", vibeEN:"Momentum", vibeZH:"æ˜¾åŒ–ä¸è¡ŒåŠ¨",
    baseEN:"You have all the necessary tools. Commit to a clear direction and demonstrate that your skill is real.",
    baseZH:"èµ„æºã€å¤©èµ‹å’Œæ—¶æœºå·²å°±ä½ã€‚å®šä¸‹æ–¹å‘æœæ–­æŠ•å…¥ï¼Œç”¨è¡ŒåŠ¨è¯æ˜ä½ çš„èƒ½åŠ›è¶³ä»¥å°†æ„å›¾æ˜¾åŒ–ã€‚",
    imgReal:"images/magician.jpg" },
  { nameEN:"Strength", nameZH:"åŠ›é‡", vibeEN:"Courage", vibeZH:"æ¸©æŸ”çš„å¾æœ",
    baseEN:"Inner power is gentle yet firm. Be patient and kind to yourself while staying unshakeable in your resolve.",
    baseZH:"æ¸©æŸ”è€Œåšå®šçš„å†…åœ¨åŠ›é‡æœ€ä¸ºå¼ºå¤§ã€‚å¯¹è‡ªå·±æŠ±æŒè€å¿ƒä¸æ…ˆæ‚²ï¼Œä½†åœ¨åŸåˆ™é—®é¢˜ä¸Šè¦ç«™ç¨³ã€‚",
    imgReal:"images/strength.jpg" },
  { nameEN:"Justice", nameZH:"æ­£ä¹‰", vibeEN:"Alignment", vibeZH:"å¹³è¡¡ä¸å› æœ",
    baseEN:"Seek fairness and clean boundaries. The reality you consistently reinforce is the one that will manifest.",
    baseZH:"åšå‡ºå…¬æ­£ã€å¹³è¡¡çš„é€‰æ‹©ï¼Œåˆ’æ¸…ç•Œé™ã€‚ä½ æŒç»­æŠ•å…¥ç²¾åŠ›çš„åœ°æ–¹ï¼Œç»ˆå°†æˆä¸ºä½ çš„ç°å®ã€‚",
    imgReal:"images/justice.jpg" },
  { nameEN:"Temperance", nameZH:"èŠ‚åˆ¶", vibeEN:"Harmony", vibeZH:"è°ƒå’Œä¸èŠ‚å¥",
    baseEN:"Find your sacred rhythm. Small, deliberate adjustments now will create deep, lasting stability.",
    baseZH:"è°ƒèŠ‚å¥½è‡ªå·±çš„å†…åœ¨èŠ‚å¥æ˜¯æ­¤åˆ»æœ€å¥½çš„è‰¯è¯ã€‚æœ‰æ„è¯†çš„ä¿®æ­£ï¼Œå¸¦æ¥é•¿ä¹…çš„ç¨³å®šä¸å¹³è¡¡ã€‚",
    imgReal:"images/temperance.jpg" },
  { nameEN:"Wheel of Fortune", nameZH:"å‘½è¿ä¹‹è½®", vibeEN:"Turning point", vibeZH:"è½¬æŠ˜ä¸æœºä¼š",
    baseEN:"The cycles of fortune are turning. Embrace flexibility to transform change into a genuine opportunity.",
    baseZH:"å‘½è¿æ­£åœ¨æ‚„æ‚„è½¬æŠ˜ã€‚ä¿æŒçµæ´»ï¼ŒæŠŠçœ¼å‰çš„å˜åŒ–å˜æˆä½ çš„å¥½æœºä¼šã€‚",
    imgReal:"images/wheel.jpg" },
  { nameEN:"The World", nameZH:"ä¸–ç•Œ", vibeEN:"Completion", vibeZH:"åœ†æ»¡ä¸å‡çº§",
    baseEN:"A major chapter closes successfully. This achievement is earned, and you are ready to level up your life.",
    baseZH:"ä¸€ä¸ªé‡è¦çš„é˜¶æ®µå·²åœ†æ»¡æ”¶å®˜ã€‚è¿™ä»½æˆå°±æ˜¯ä½ åŠªåŠ›çš„æˆæœï¼Œä½ å·²å‡†å¤‡å¥½è¿ˆå‘æ›´å¹¿é˜”çš„å¤©åœ°ã€‚",
    imgReal:"images/world.jpg" },
  { nameEN:"The Lovers", nameZH:"æ‹äºº", vibeEN:"Choice & connection", vibeZH:"ä»·å€¼ä¸é€‰æ‹©",
    baseEN:"The decision is moral and emotional. Prioritize your core values over external pressure or performance.",
    baseZH:"åšå‡ºå¿ äºå†…å¿ƒçš„é€‰æ‹©ã€‚ä»¥ä½ çš„æ ¸å¿ƒä»·å€¼è§‚ä¸ºä¼˜å…ˆï¼Œè€Œä¸æ˜¯ä¸ºäº†è¿åˆå¤–ç•Œçš„æœŸå¾…ã€‚",
    imgReal:"images/lovers.jpg" },
  { nameEN:"The Chariot", nameZH:"æˆ˜è½¦", vibeEN:"Drive", vibeZH:"å¾æœä¸æ¨è¿›",
    baseEN:"Achieve focused progress through willpower. Self-discipline and clear boundaries are your path to freedom.",
    baseZH:"ç›®æ ‡æ˜ç¡®ï¼Œå¤§èƒ†å‘å‰å†²åˆºã€‚ä½ ä¼šå‘ç°ï¼Œè‰¯å¥½çš„è‡ªå¾‹èƒ½å¸¦æ¥æ›´å¤§çš„æŒæ§æ„Ÿå’Œè‡ªç”±ã€‚",
    imgReal:"images/chariot.jpg" },
  { nameEN:"Death", nameZH:"æ­»ç¥", vibeEN:"Transformation", vibeZH:"èœ•å˜ä¸é‡ç”Ÿ",
    baseEN:"A powerful ending is required for the new beginning. The inevitable upgrade follows the necessary goodbye.",
    baseZH:"æ˜¯æ—¶å€™æ”¾ä¸‹ä¸å†æœåŠ¡ä½ çš„æ—§äº‹ç‰©äº†ã€‚çœŸæ­£çš„èœ•å˜ä¸é‡ç”Ÿï¼Œéƒ½ä»å‹‡æ•¢å‘Šåˆ«å¼€å§‹ã€‚",
    imgReal:"images/death.jpg" },
  { nameEN:"The Hermit", nameZH:"éšè€…", vibeEN:"Reflection", vibeZH:"å†…çœä¸æ™ºæ…§",
    baseEN:"Withdraw to gain clarity and insight. Quiet solitude is the necessary strategy before action.",
    baseZH:"ä»å–§åš£ä¸­é€€ä¸€æ­¥ï¼Œæ‰èƒ½çœ‹å¾—æ›´æ¸…æ¥šã€‚ç‹¬å¤„çš„æ—¶å…‰æ˜¯åœ¨ä¸ºä½ é…é…¿æ›´æ·±è¿œçš„ç­–ç•¥ä¸æ™ºæ…§ã€‚",
    imgReal:"images/hermit.jpg" },
  { nameEN: "The Hanged Man",
    nameZH: "å€’åŠäºº",
    vibeEN: "Perspective Shift",
    vibeZH: "é¢ è¦†è§†è§’",
    baseEN: "Stop fighting and surrender. A necessary pause will reveal a new angle on your situation.",
    baseZH: "åœæ­¢æŒ£æ‰ï¼Œå­¦ä¼šè‡£æœã€‚ä¸€æ¬¡å¿…è¦çš„æš‚åœï¼Œä¼šä»å…¨æ–°çš„è§’åº¦æ­ç¤ºé—®é¢˜çš„çœŸç›¸ã€‚",
    imgReal: "images/hanged_man.jpg"},
  { nameEN: "The Devil",
    nameZH: "æ¶é­”",
    vibeEN: "Restriction & Obsession",
    vibeZH: "æ‰§å¿µä¸æŸç¼š",
    baseEN: "You are trapped by self-made chains. Name your unhealthy attachments; you have the power to break free.",
    baseZH: "ä½ è¢«è‡ªå·±åˆ¶é€ çš„æ·é”å›°ä½ã€‚è®¤æ¸…é‚£äº›ä¸å¥åº·çš„æ‰§å¿µï¼Œä½ æ‹¥æœ‰éšæ—¶æŒ£è„±çš„åŠ›é‡ã€‚",
    imgReal: "images/devil.jpg"},
  { nameEN: "The Moon",
    nameZH: "æœˆäº®",
    vibeEN: "Illusion & Intuition",
    vibeZH: "å¹»è±¡ä¸æ½œæ„è¯†",
    baseEN: "Navigate the fog by instinct. Trust your deep intuition over logic to see through confusion and fear.",
    baseZH: "åœ¨è¿·é›¾ä¸­é æœ¬èƒ½å¯¼èˆªã€‚ç›¸ä¿¡ä½ çš„ç›´è§‰è€Œéé€»è¾‘ï¼Œå®ƒèƒ½ç©¿é€æ··ä¹±å’Œå¹»è±¡ã€‚",
    imgReal: "images/moon.jpg"},
  { nameEN: "Judgement",
    nameZH: "å®¡åˆ¤",
    vibeEN: "Reckoning & Calling",
    vibeZH: "è§‰é†’ä¸å¬å”¤",
    baseEN: "Answer the call to a higher purpose. Self-assessment and forgiveness are required before your next great leap.",
    baseZH: "å›åº”æ›´é«˜çš„ä½¿å‘½å¬å”¤ã€‚åœ¨åšå‡ºä¸‹ä¸€æ¬¡é£è·ƒå‰ï¼Œéœ€è¦å›é¡¾è¿‡å»å¹¶å®½æ•è‡ªå·±ã€‚",
    imgReal: "images/judgement.jpg"}
];

function svgToDataUrl(svg){
  const encoded = encodeURIComponent(svg).replace(/'/g,"%27").replace(/"/g,"%22");
  return `data:image/svg+xml;charset=utf-8,${encoded}`;
}
function hash(str){
  let h = 2166136261;
  for (let i=0;i<str.length;i++){
    h ^= str.charCodeAt(i);
    h = Math.imul(h, 16777619);
  }
  return h >>> 0;
}
function pickGlyph(seed){
  // Added more glyphs for more variety (â˜¿, â™„, â™ƒ, â™†)
  const glyphs = ["âœ¦","âœ§","â˜‰","â˜¾","âš","âšœ","âœ¶","âŸ¡","âš¹","âœ·","â–","âŸ ","âœº","â˜¿","â™„","â™ƒ","â™†"];
  return glyphs[seed % glyphs.length];
}
function escapeXml(s){
  return String(s).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");
}
function stars(seed){
  let s = "";
  for(let i=0;i<26;i++){
    seed = (seed * 1664525 + 1013904223) >>> 0;
    const x = 42 + (seed % 336);
    seed = (seed * 1664525 + 1013904223) >>> 0;
    const y = 44 + (seed % 210);
    seed = (seed * 1664525 + 1013904223) >>> 0;
    const r = 0.8 + ((seed % 12) / 10);
    const o = 0.14 + ((seed % 55) / 240);
    s += `<circle cx="${x}" cy="${y}" r="${r}" fill="rgba(26,29,43,${o})"/>`;
  }
  return s;
}
function makeCardArt(cardName, themeA, themeB){
  const seed = hash(cardName);
  const glyph = pickGlyph(seed);
  const wave = (seed % 12) + 8;
  const svg = `
    <svg xmlns="http://www.w3.org/2000/svg" width="420" height="680" viewBox="0 0 420 680">
      <defs>
        <linearGradient id="bg" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0" stop-color="${themeA}" stop-opacity="0.96"/>
          <stop offset="1" stop-color="${themeB}" stop-opacity="0.96"/>
        </linearGradient>
        <radialGradient id="glow" cx="30%" cy="20%" r="70%">
          <stop offset="0" stop-color="#fff" stop-opacity="0.26"/>
          <stop offset="1" stop-color="#fff" stop-opacity="0"/>
        </radialGradient>
        <filter id="softShadow" x="-30%" y="-30%" width="160%" height="160%">
          <feDropShadow dx="0" dy="10" stdDeviation="12" flood-color="#000" flood-opacity="0.16"/>
        </filter>
      </defs>

      <rect x="18" y="18" width="384" height="644" rx="28" fill="url(#bg)" filter="url(#softShadow)"/>
      <rect x="28" y="28" width="364" height="624" rx="24" fill="none" stroke="rgba(26,29,43,0.18)" stroke-width="2"/>
      <rect x="18" y="18" width="384" height="644" rx="28" fill="url(#glow)"/>

      ${stars(seed)}

      <g opacity="0.92">
        <text x="210" y="350" text-anchor="middle" font-size="92" fill="rgba(26,29,43,0.78)"
              font-family="ui-sans-serif, system-ui">${glyph}</text>
      </g>

      <path d="M 28 520 C 90 ${520-wave} 150 ${520+wave} 210 520 C 270 ${520-wave} 330 ${520+wave} 392 520 L 392 620 L 28 620 Z"
            fill="rgba(255,255,255,0.18)"/>
      <path d="M 28 550 C 90 ${550+wave} 150 ${550-wave} 210 550 C 270 ${550+wave} 330 ${550-wave} 392 550"
            fill="none" stroke="rgba(26,29,43,0.18)" stroke-width="2"/>

      <rect x="58" y="590" width="304" height="52" rx="16" fill="rgba(255,255,255,0.30)" stroke="rgba(26,29,43,0.14)"/>
      <text x="210" y="624" text-anchor="middle" font-size="18" fill="rgba(26,29,43,0.86)"
            font-family="ui-sans-serif, system-ui" font-weight="900">
        ${escapeXml(cardName)}
      </text>
    </svg>
  `;
  return svgToDataUrl(svg);
}
function cardColors(nameEN){
  const map = {
    "The Star": ["#b9e6ff", "#c9ffe8"],
    "The Sun": ["#ffe2b9", "#ffd0dc"],
    "The Fool": ["#d6d3ff", "#c9ffe8"],
    "The High Priestess": ["#c6d8ff", "#f3d3ff"],
    "The Empress": ["#c9ffe8", "#ffe2b9"],
    "The Magician": ["#ffd0dc", "#c6d8ff"],
    "Strength": ["#ffe2b9", "#c9ffe8"],
    "Justice": ["#c6d8ff", "#c9ffe8"],
    "Temperance": ["#c9ffe8", "#d6d3ff"],
    "Wheel of Fortune": ["#ffd0dc", "#ffe2b9"],
    "The World": ["#c9ffe8", "#c6d8ff"],
    "The Lovers": ["#ffd0dc", "#ffe2b9"],
    "The Chariot": ["#c6d8ff", "#ffe2b9"],
    "Death": ["#d6d3ff", "#ffd0dc"],
    "The Hermit": ["#c6d8ff", "#c9ffe8"],
    
    // --- Newly Added Cards ---
    "The Hanged Man": ["#a8c0ff", "#d6d3ff"], 
    "The Devil": ["#e2b9c9", "#d6d3ff"],
    "The Moon": ["#c6d8ff", "#f3d3ff"],
    "Judgement": ["#ffe2b9", "#b9e6ff"]       
};
  return map[nameEN] || ["#c6d8ff","#c9ffe8"];
}
function pick3(){
  const copy = [...deck];
  const out = [];
  for(let i=0;i<3;i++){
    const idx = Math.floor(Math.random()*copy.length);
    const card = copy.splice(idx,1)[0];
    const [a,b] = cardColors(card.nameEN);
    out.push({ ...card, img: REAL_TAROT_IMAGES ? card.imgReal : makeCardArt(card.nameEN, a, b) });
  }
  return out;
}

/* ===== zodiac + reading engine + other helpers ===== */
/* (keeping your original functions; omitted here for brevity in this message would break copy/paste) */

/* =========================================================
   IMPORTANT:
   Paste the REST of your original JS here unchanged
   (from zodiacFlavor... all the way down),
   EXCEPT keep this one line in renderAll:
   shareMeta.textContent = t[LANG].shareGenerated;
   ========================================================= */
function zodiacFlavor(z){
  const enMap = {
    aries:"bold starts", taurus:"steady building", gemini:"curiosity & learning",
    cancer:"home & feelings", leo:"visibility & confidence", virgo:"systems & craft",
    libra:"balance & relationships", scorpio:"depth & transformation", sagittarius:"adventure & truth",
    capricorn:"ambition & structure", aquarius:"originality & independence", pisces:"intuition & creativity"
  };
  const zhMap = {
    aries:"å……æ»¡æ´»åŠ›ï¼Œå¯Œæœ‰å¼€åˆ›ç²¾ç¥ï¼Œæœ‰æ—¶è¿‡äºæ€¥èº", taurus:"è„šè¸å®åœ°ï¼Œæ³¨é‡æ„Ÿå®˜ä½“éªŒï¼Œå›ºæ‰§", gemini:"å¥½å¥‡å¿ƒå¼ºï¼Œå–„äºæ²Ÿé€šï¼Œå¤šæ‰å¤šè‰º",
    cancer:"å……æ»¡çˆ±å¿ƒï¼Œç›´è§‰æ•é”ï¼Œå¤šæ„å–„æ„Ÿ", leo:"è‡ªä¿¡ï¼Œå¯Œæœ‰æˆå‰§æ€§ï¼Œé›„å¿ƒå‹ƒå‹ƒ", virgo:"å–„äºåˆ†æï¼Œæ³¨é‡ç»†èŠ‚ï¼ŒåŠ¡å®",
    libra:"è¿½æ±‚å’Œè°ï¼Œå¹³è¡¡ï¼Œåœ†æ»‘", scorpio:"å¼ºçƒˆï¼Œå…·æœ‰å˜é©æ€§ï¼Œå……æ»¡æ¿€æƒ…", sagittarius:"ä¹è§‚ï¼Œæœ‰å“²å­¦æ€æƒ³ï¼Œçƒ­çˆ±è‡ªç”±",
    capricorn:"è‡ªå¾‹ï¼Œè´Ÿè´£ä»»ï¼Œå†…æ•›", aquarius:"åˆ›æ–°ï¼Œäººé“ä¸»ä¹‰ï¼Œç‹¬ç«‹", pisces:"å¯Œæœ‰æƒ³è±¡åŠ›ï¼Œå¯Œæœ‰åŒæƒ…å¿ƒï¼Œæ•æ„Ÿ"
  };
  return { en: enMap[z] || "", zh: zhMap[z] || "" };
}
function zodiacNameZH(z){
  const map = {
    aries:"ç™½ç¾Šåº§", taurus:"é‡‘ç‰›åº§", gemini:"åŒå­åº§", cancer:"å·¨èŸ¹åº§",
    leo:"ç‹®å­åº§", virgo:"å¤„å¥³åº§", libra:"å¤©ç§¤åº§", scorpio:"å¤©èåº§",
    sagittarius:"å°„æ‰‹åº§", capricorn:"æ‘©ç¾¯åº§", aquarius:"æ°´ç“¶åº§", pisces:"åŒé±¼åº§"
  };
  return map[z] || "";
}

/* =========================================================
   â€œLess genericâ€ reading engine (agent-ish but local)
   - Uses: 2025/2026 keyword signals + goal lens + zodiac vibe + card combo axis
   - DOES NOT repeat base meaning (already on card)
   ========================================================= */
function cardAxis(card){
  const m = {
    "Justice":"alignment",
    "Temperance":"rhythm",
    "The Sun":"clarity",
    "The Star":"renewal",
    "The Empress":"nurture",
    "The Magician":"agency",
    "Strength":"courage",
    "The Lovers":"values",
    "The Chariot":"momentum",
    "Death":"release",
    "The Hermit":"reflection",
    "Wheel of Fortune":"flex",
    "The World":"completion",
    "The Fool":"start"
  };
  return m[card.nameEN] || "focus";
}

function keywordSignals(words){
  const w = words.map(x=>String(x).toLowerCase().trim());
  const has = (...k)=>k.some(x=>w.includes(x));
  
  return {

    recovery: has("rest","heal","self-care","health","balance","calm","peace","sleep", 
                   "restore", "slow", "steady", "wellness", "recharge", "quiet", "renewal", 
                   "unwind", "detox", "mindfulness", "patience", "ease"),
    
    clarity: has("clarity","focus","simple","direction","decisive","clean", 
                   "structure", "organize", "clear", "intentional", "plan", "boundaries", "purpose",
                   "vision", "truth", "insight", "strategy", "alignment", "goal"),

    ambition: has("career","success","promotion","money","ambitious","driven","grind","win",
                    "income", "hustle", "achieve", "visibility", "progress", "goals", "wealth", "fame",
                    "authority", "leadership", "status", "power", "business", "launch"),

    connection: has("love","relationship","family","friends","connection",
                     "social", "community", "belonging", "dating", "partner", "intimacy", "vulnerable",
                     "bond", "marriage", "trust", "communication", "support", "empathy"),

    growth: has("growth","learn","learning","curious","explore","improve",
                     "skill", "knowledge", "mastery", "change", "upgrade", "better", "evolve", "new",
                     "potential", "development", "wisdom", "evolve", "expansion"),

    burnout: has("tired","burnout","overwhelmed","stressed","anxious","exhausted",
                     "fatigue", "drained", "stuck", "frustrated", "pressure", "sad", "grief", "heavy",
                     "crisis", "trapped", "lost", "doubt", "despair", "confusion"),

    adventure: has("travel", "adventure", "explore", "brave", "risk", "novelty", "fun", "excited", "thrill", 
                     "spontaneous", "move", "journey", "change of pace", "unknown", "leap"),

    stability: has("stable", "consistent", "secure", "safe", "home", "foundation", "base", "grounded", 
                     "routine", "steady", "reliable", "anchor", "root", "commitment", "order")
  };
}

function goalLens(goal){
  const en = {
    love:"connection + honesty + emotional safety",
    family:"support systems + boundaries + steady presence",
    health:"energy management + consistency + recovery",
    career:"focus + visibility + strategy + momentum",
    money:"stability + smarter choices + long-term security",
    "self-growth":"identity upgrades + self-trust + new patterns",
    adventure:"bravery + novelty + saying yes to life",
    creativity:"play + output + protecting creative time"
  };
  const zh = {
    love:"æ·±åº¦è¿æ¥ + çœŸè¯šæ²Ÿé€š + æƒ…ç»ªè¸å®æ„Ÿ",
    family:"äº’ç›¸æ”¯æŒ + æ˜ç¡®ç•Œé™ + ç¨³å®šçš„çˆ±ä¸é™ªä¼´",
    health:"èƒ½é‡ç®¡ç† + æŒç»­è§„å¾‹ + é«˜æ•ˆæ¢å¤",
    career:"ä¸“æ³¨ + é•¿æœŸç­–ç•¥ + æ‰§è¡ŒåŠ›",
    money:"è´¢åŠ¡ç¨³å®š + èªæ˜æ¶ˆè´¹è§‚ + é•¿æœŸå®‰å¿ƒæ„Ÿ",
    "self-growth":"èº«ä»½èœ•å˜ + ç›¸ä¿¡è‡ªå·± + å»ºç«‹æ–°ä¹ æƒ¯",
    adventure:"é¼“èµ·å‹‡æ°” + æ‹¥æŠ±æ–°é²œæ„Ÿ + å¯¹ç”Ÿæ´»è¯´â€œæˆ‘æ„¿æ„â€",
    creativity:"ä¿æŒç©å¿ƒ + ç¡®ä¿äº§å‡º + å®ˆæŠ¤ä½ çš„åˆ›ä½œæ—¶æ®µ"
  };
  return LANG==="zh" ? (zh[goal] || "æ›´è´´è¿‘è‡ªå·±çš„æˆé•¿") : (en[goal] || "alignment and progress");
}


function microProfile(profile){
  const s25 = keywordSignals(profile.selfWords);
  const s26 = keywordSignals(profile.hopeWords);

  // --- ZH (Mandarin) ---
  if(LANG==="zh"){
    // 1. Stress -> Solution
    if(s25.burnout && s26.recovery) return "ä½ ä¸æ˜¯ä¸å¤ŸåŠªåŠ›ï¼Œæ˜¯åŠªåŠ›å¤ªä¹…äº†ã€‚2026 å¹´çš„å…³é”®ï¼Œæ˜¯æŠŠæ¢å¤å’Œä¼‘æ¯å˜æˆä¸€ä¸ªè®¡åˆ’ã€‚";
    // 2. High effort -> Need for strategy
    if(s25.ambition && s26.clarity) return "ä½ èƒ½åŠ›å¾ˆå¼ºï¼Œä½†ä¸‹ä¸€æ­¥ä¸æ˜¯æ›´æ‹¼å‘½ï¼Œè€Œæ˜¯æ‰¾åˆ°æ›´æ¸…æ™°ã€æ›´æŒä¹…çš„åŠªåŠ›æ–¹å‘ã€‚";
    // 3. Connection reinforcement
    if(s25.connection && s26.connection) return "ä½ æƒ³è¦çš„ä¸æ˜¯äººå¤šçƒ­é—¹ï¼Œè€Œæ˜¯çœŸæ­£çš„ç¡®å®šæ„Ÿï¼šå¦è¯šã€ç•Œé™ï¼Œä»¥åŠè¢«æ¸©æŸ”ä»¥å¾…ã€‚";
    // 4. Growth reinforcement
    if(s25.growth && s26.growth) return "ä½ æ­£åœ¨è®¤çœŸåœ°å‡çº§è‡ªå·±ã€‚2026 å¹´é€‚åˆæŠŠå­¦ä¹ åˆ°çš„çŸ¥è¯†ï¼Œè½¬åŒ–æˆçœ‹å¾—åˆ°çš„å…·ä½“æˆæœã€‚";
    // 5. Growth -> Action/Results
    if(s25.growth && s26.ambition) return "å»å¹´ä½ ç§¯ç´¯äº†çŸ¥è¯†ã€‚ç°åœ¨ï¼Œæ˜¯æ—¶å€™æŠŠè¿™äº›å­¦ä¹ ç›´æ¥è½¬åŒ–ä¸ºäº‹ä¸šå’Œè´¢å¯Œä¸Šçš„èƒœåˆ©äº†ã€‚";
    // 6. Extreme Stress -> Need for Safety
    if(s25.burnout && s26.stability) return "ä½ éœ€è¦ä¸€å—åšå®çš„åœ°åŸºã€‚å…ˆåˆ«æƒ³å¤§å˜åŠ¨â€”â€”2026 å¹´è¦å…ˆä¿æŠ¤æ—¥å¸¸ï¼Œå»ºç«‹å®‰å…¨æ„Ÿã€‚";
    // 7. Stable Base -> Launchpad
    if(s25.stability && s26.adventure) return "åœ°åŸºå·²æ‰“å¥½ã€‚ä½ çš„å®‰å…¨æ„Ÿå°±æ˜¯ä½ å‘å°„çš„è·‘é“ï¼Œå¯ä»¥è¿›è¡Œæœ‰è®¡åˆ’çš„ã€å¿«ä¹çš„å†’é™©ã€‚";
    // 8. Overwork -> Forced Slowdown
    if(s25.ambition && s26.recovery) return "ä½ å·²ç»æ”¶è·äº†è®¸å¤šï¼Œä½†ä¹Ÿæœ‰æŸè€—ã€‚æ˜å¹´æ˜¯ç»´æŠ¤æœŸï¼Œä¸æ˜¯è¿½æ±‚æœ€å¤§äº§å‡ºçš„æ—¶å€™ã€‚";
    // 9. Knowing -> Bold Action
    if(s25.clarity && s26.adventure) return "ä½ å·²ç»çŸ¥é“è‡ªå·±è¦ä»€ä¹ˆäº†ã€‚ç°åœ¨ï¼Œ2026 å¹´çš„å…³é”®æ˜¯æ‰¾åˆ°å¤§èƒ†ã€åˆ›æ–°çš„æ–¹æ³•å»å®ç°å®ƒã€‚";
    // 10. Social Overload -> Better Boundaries
    if(s25.connection && s26.clarity) return "ä½ å·²å‡†å¤‡å¥½åˆ’æ¸…ç•Œé™ã€‚2026 å¹´çš„ç›®æ ‡æ˜¯æ‹¥æœ‰æ›´å°‘ã€ä½†è´¨é‡æ›´é«˜çš„å…³ç³»ã€‚";
    // 11. Wanderlust -> Anchoring
    if(s25.adventure && s26.stability) return "ä½ å®Œæˆäº†æ¢ç´¢å’Œçˆ†å‘ã€‚ç°åœ¨çš„èƒœåˆ©åœ¨äºæŠŠè¿™äº›æ–°å‘ç°èå…¥å¯æŒç»­çš„ç”Ÿæ´»æ¨¡å¼ã€‚";
    // 12. Strategy -> Execute
    if(s25.clarity && s26.ambition) return "ç›®æ ‡å·²ç»å¾ˆæ¸…æ™°ã€‚2026 å¹´å°±æ˜¯å…¨åŠ›ä¿¡ä»»ä½ çš„æ–¹å‘ï¼Œå¹¶å°†åŠ¨èƒ½æ‹‰åˆ°æœ€å¤§ã€‚";
    // 13. Ambition -> Stability
    if(s25.ambition && s26.stability) return "ç°åœ¨ä½ éœ€è¦é”å®šæˆæœã€‚2026 å¹´é‡ç‚¹ä¸åœ¨äºçˆ¬å¾—æ›´é«˜ï¼Œè€Œæ˜¯è¦ç¡®ä¿ä½ å½“å‰æ‰€å¤„çš„é«˜åº¦æ˜¯ç¨³å›ºçš„ã€‚";
    // 14. Connection -> Growth
    if(s25.connection && s26.growth) return "ä½ çš„å…³ç³»ç½‘æä¾›äº†æˆé•¿çš„å®‰å…¨ç©ºé—´ã€‚åˆ©ç”¨è¿™ä»½æ”¯æŒå»æ¨åŠ¨è‡ªå·±æŒæ¡ä¸€é¡¹æ–°æŠ€èƒ½ã€‚";
    // 15. Growth -> Clarity
    if(s25.growth && s26.clarity) return "ä½ å¸æ”¶äº†å¤§é‡æ–°çŸ¥è¯†ã€‚ç°åœ¨çš„å…³é”®æ˜¯æŠŠå®ƒä»¬è¿‡æ»¤æˆä¸€ä¸ªæ¸…æ™°ã€å¯æ‰§è¡Œçš„æ–¹å‘ã€‚";
    // 16. Recovery -> Ambition
    if(s25.recovery && s26.ambition) return "ä½ çš„èƒ½é‡å›æ¥äº†ã€‚2026 å¹´å°±æ˜¯è¦ç”¨ä¸€ä¸ªæ˜ç¡®çš„ç›®æ ‡ï¼Œæ¥æµ‹è¯•ä½ æ–°æ¢å¤ç³»ç»Ÿçš„åŠ›é‡ã€‚";
    // 17. Burnout -> Adventure
    if(s25.burnout && s26.adventure) return "é€ƒç¦»æ˜¯å¯èƒ½çš„ï¼Œä½†å¿…é¡»æ˜¯æœ‰è®¡åˆ’çš„ã€‚ä½ çš„å†’é™©åº”è¯¥ä¼˜å…ˆè€ƒè™‘ä¹è¶£ï¼Œè€Œéç›®çš„åœ°æˆ–æˆæœã€‚";
    // 18. Adventure -> Growth
    if(s25.adventure && s26.growth) return "ä½ æ”¶é›†äº†ç‹¬ç‰¹çš„ç»éªŒã€‚ç°åœ¨çš„èƒœåˆ©åœ¨äºå°†è¿™äº›æ–°å¥‡æ„Ÿè½¬åŒ–ä¸ºæŒä¹…çš„ä¸ªäººæˆé•¿ã€‚";
    // 19. Clarity -> Stability
    if(s25.clarity && s26.stability) return "ä½ å·²ç»æœ‰äº†åœ°å›¾ã€‚ç°åœ¨çš„é‡ç‚¹æ˜¯å»ºç«‹å¯é ã€ç¨³å®šçš„æ—¥å¸¸ï¼Œè®©å‰è¿›å˜æˆä¸€ç§ä¹ æƒ¯ã€‚";
    // 20. Stability -> Growth
    if(s25.stability && s26.growth) return "ä½ çš„å®‰å…¨åœ°åŸºå·²å‡†å¤‡å°±ç»ªã€‚åˆ©ç”¨è¿™ä¸ªå¯é¢„æµ‹çš„åŸºç¡€ï¼Œå¯åŠ¨æ·±åº¦ã€èšç„¦çš„è‡ªæˆ‘å‘å±•ã€‚";

    // Default/Catch-all
    return "ä½ æ­£åœ¨ä»â€œç¡¬æ’‘ç€è¿‡æ—¥å­â€èµ°å‘â€œæ´»å‡ºçœŸæ­£çš„è‡ªå·±â€ï¼Œè¿™ä¸ªè½¬å˜æœ¬èº«å°±æ˜¯æœ€å¥½çš„å…†å¤´ã€‚";
  }

  // --- EN (English) ---
  
  // 1. Stress -> Solution
  if(s25.burnout && s26.recovery) return "You werenâ€™t lazyâ€”you were carrying too much. 2026 is about making recovery a real system.";
  // 2. High effort -> Need for strategy
  if(s25.ambition && s26.clarity) return "Youâ€™re capable. Your next upgrade isnâ€™t more hustleâ€”itâ€™s direction + sustainability.";
  // 3. Connection reinforcement
  if(s25.connection && s26.connection) return "You donâ€™t want chaosâ€”you want safe connection: honesty, boundaries, and being treated well.";
  // 4. Growth reinforcement
  if(s25.growth && s26.growth) return "Youâ€™re leveling up on purpose. 2026 is about turning learning into visible wins.";
  // 5. Growth -> Action/Results
  if(s25.growth && s26.ambition) return "You built the knowledge last year. Now, channel that learning directly into career and financial wins.";
  // 6. Extreme Stress -> Need for Safety
  if(s25.burnout && s26.stability) return "You need firm ground. Forget big changesâ€”2026 is about protecting your routine and building safety first.";
  // 7. Stable Base -> Launchpad
  if(s25.stability && s26.adventure) return "The groundwork is done. Your security is your launchpad for calculated, joyful risk.";
  // 8. Overwork -> Forced Slowdown
  if(s25.ambition && s26.recovery) return "You achieved a lot, but at a cost. Next year is about maintenance, not maximum output.";
  // 9. Knowing -> Bold Action
  if(s25.clarity && s26.adventure) return "You know *what* you want. Now, 2026 is about finding bold, new *ways* to get there.";
  // 10. Social Overload -> Better Boundaries
  if(s25.connection && s26.clarity) return "Youâ€™re ready for better boundaries. The goal is fewer, higher-quality relationships.";
  // 11. Wanderlust -> Anchoring
  if(s25.adventure && s26.stability) return "You had your big burst of exploration. The win now is weaving those discoveries into a sustainable lifestyle.";
  // 12. Strategy -> Execute
  if(s25.clarity && s26.ambition) return "You know the target. 2026 is the year to trust your direction and apply maximum momentum.";
  // 13. Ambition -> Stability
  if(s25.ambition && s26.stability) return "You need to lock in your gains. 2026 is less about the next climb, and more about securing your current height.";
  // 14. Connection -> Growth
  if(s25.connection && s26.growth) return "Your relationships provide the safe space you need to grow. Use that support system to push into new skills.";
  // 15. Growth -> Clarity
  if(s25.growth && s26.clarity) return "Youâ€™ve gathered many new inputs. Now, the key is filtering that knowledge into one sharp, actionable direction.";
  // 16. Recovery -> Ambition
  if(s25.recovery && s26.ambition) return "Your energy is back. 2026 is the year to test the strength of your refreshed system with a specific goal.";
  // 17. Burnout -> Adventure
  if(s25.burnout && s26.adventure) return "Escape is possible, but it must be intentional. Your adventure should prioritize fun over performance or destinations.";
  // 18. Adventure -> Growth
  if(s25.adventure && s26.growth) return "You've gathered unique experiences. The win now is translating that novelty into sustained personal evolution.";
  // 19. Clarity -> Stability
  if(s25.clarity && s26.stability) return "You have the map. The focus now is on building the reliable, consistent routine that makes the journey automatic.";
  // 20. Stability -> Growth
  if(s25.stability && s26.growth) return "Your secure base is ready. Use that predictable foundation as a launchpad for deep, focused personal development.";

  // Default/Catch-all
  return "Youâ€™re moving from â€œgetting through itâ€ to â€œliving like yourself,â€ and that shift matters.";
}

function comboInsight(cards, profile){
  const past = cardAxis(cards[0]);
  const now  = cardAxis(cards[1]);
  const fut  = cardAxis(cards[2]);
  const g = profile.goal;

  const s26 = keywordSignals(profile.hopeWords);
  const moves = [];
  const add = (en, zh)=>moves.push({en, zh});

// future-led guidance (most differentiating)
  if(fut === "alignment"){
    add(
      `2026 wants clean alignment: pick fewer things, but pick them on purpose. Filter all decisions through your top goal for ${cap(g)}.`,
      `2026 æ›´å¼ºè°ƒâ€œç²¾å‡†å¯¹é½â€ï¼šå°‘åšç‚¹ï¼Œä½†ç¡®ä¿æ¯ä»¶éƒ½å¸¦ç€æ˜ç¡®ç›®æ ‡ã€‚æ‰€æœ‰å†³å®šéƒ½è¦å…ˆç»è¿‡ ${cap(g)} è¿™ä¸ªæœ€é«˜ç›®æ ‡çš„ç­›é€‰ã€‚` 
    );
  }
  if(fut === "rhythm"){
    add(
      `Your edge is rhythm: build one weekly loop you can keep even on low-energy days. The goal isn't speed, but never stopping.`,
      `ä½ çš„ä¼˜åŠ¿åœ¨äºâ€œèŠ‚å¥æ„Ÿâ€ï¼šå»ºç«‹ä¸€ä¸ªå“ªæ€•ä½èƒ½é‡æ—¶ä¹Ÿèƒ½åšæŒä¸‹å»çš„æ¯å‘¨å¾ªç¯ã€‚ç›®æ ‡ä¸æ˜¯é€Ÿåº¦ï¼Œè€Œæ˜¯æ°¸ä¸åœæ­¢ã€‚` 
    );
  }
  if(fut === "renewal"){
    add(
      `This is a â€œrebuild your baselineâ€ year: small wins stacked calmly will beat heroic bursts. Focus on foundational habits (sleep, food, movement) first.`,
      `è¿™æ˜¯â€œå…»åº•ç›˜â€çš„ä¸€å¹´ï¼šå¹³é™åœ°ç§¯ç´¯å°èƒœåˆ©ï¼Œæ¯”çˆ†å‘å¼åœ°çŒ›å†²æ›´æœ‰æ•ˆã€‚ä¼˜å…ˆå…³æ³¨ä½ çš„åŸºç¡€ä¹ æƒ¯ï¼šç¡çœ ã€é¥®é£Ÿå’Œè¿åŠ¨ã€‚`    
    );
  }
  if(fut === "momentum"){
    add(
      `Green light year: once you choose a lane, youâ€™ll move fastâ€”protect focus like itâ€™s money. Time saved by saying 'no' is your new currency.`,
      `è¿™æ˜¯â€œå¼€ç»¿ç¯â€çš„ä¸€å¹´ï¼šä¸€æ—¦é€‰å®šè·‘é“å°±ä¼šåŠ é€Ÿã€‚åƒä¿æŠ¤é‡‘é’±ä¸€æ ·ï¼Œä¿æŠ¤ä½ çš„ä¸“æ³¨åŠ›ã€‚å­¦ä¼šæ‹’ç»å¯ä»¥å¸®ä½ çœä¸‹å¤§é‡å®è´µæ—¶é—´ã€‚` 
    );
  }
  if(fut === "release"){
    add(
      `A reset is coming: your win is letting the outdated version of you goâ€”fast. Don't let sunk costs keep you tied to things that no longer serve your future.`,
      `ä¸€æ¬¡èœ•å˜æ­£åœ¨åˆ°æ¥ï¼šä½ çš„èƒœåˆ©å°±æ˜¯â€œå¿«é€Ÿæ”¾ä¸‹é‚£ä¸ªè¿‡æ—¶çš„è‡ªå·±â€ã€‚åˆ«è®©æ²‰æ²¡æˆæœ¬ï¼ŒæŠŠä½ ç»‘åœ¨é‚£äº›ä¸å†æœåŠ¡äºæœªæ¥çš„äº‹ç‰©ä¸Šã€‚` 
    );
  }

  // present-led â€œright nowâ€ move
  if(now === "clarity"){
    add(
      `Right now: clarity beats hustle. Make one decision youâ€™ve been avoiding, then block time immediately to act on it.`,
      `å½“ä¸‹ï¼šæ¸…æ™°æ¯”çå¿™æ›´é‡è¦ã€‚å»æå®šä¸€ä¸ªä½ ä¸€ç›´åœ¨æ‹–å»¶çš„å†³å®šï¼Œç„¶åé©¬ä¸Šä¸ºè¿™ä¸ªè¡ŒåŠ¨é¢„ç•™æ—¶é—´ã€‚`
    );
  }
  if(now === "agency"){
    add(
      `You already have tools. Stop waiting for permission and ship one concrete step. That single launch will create the momentum you need.`,
      `èµ„æºå…¶å®éƒ½å‡†å¤‡å¥½äº†ã€‚åˆ«å†ç­‰è®¸å¯äº†ï¼Œå…ˆå»æ¨è¿›ä¸€ä¸ªå…·ä½“çš„è¡ŒåŠ¨ã€‚å°±æ˜¯è¿™â€œä¸€æ¬¡å¯åŠ¨â€ä¼šä¸ºä½ åˆ›é€ éœ€è¦çš„åŠ¨åŠ›ã€‚` 
    );
  }
  if(now === "nurture" || now === "renewal"){
    add(
      `Make care practical: sleep/food/movement as defaults, not â€œif I have time.â€ Treat your physical health as the foundation for all ambition.`,
      `æŠŠç…§é¡¾è‡ªå·±è½åˆ°å®å¤„ï¼šç¡çœ ã€é¥®é£Ÿã€è¿åŠ¨æ˜¯å¿…é€‰é¡¹ï¼Œä¸æ˜¯â€œæœ‰ç©ºå†è¯´â€ã€‚æŠŠèº«ä½“å¥åº·çœ‹ä½œæ‰€æœ‰é‡å¿ƒçš„åŸºç¡€ã€‚` 
    );
  }

  // keyword-tuned finishing
  if(s26.recovery){
    add(
      `Treat recovery like a system: schedule it, track it, and donâ€™t negotiate with it. True rest is productive.`,
      `æŠŠâ€œæ¢å¤â€å½“æˆä¸€ä¸ªç³»ç»Ÿæ¥è¿è¡Œï¼šæ’è¿›æ—¥ç¨‹ã€è¿½è¸ªè¿›åº¦ï¼Œåˆ«è·Ÿå®ƒå¦¥åã€‚çœŸæ­£çš„ä¼‘æ¯ï¼Œæœ¬èº«å°±æ˜¯ä¸€ç§é«˜æ•ˆçš„äº§å‡ºã€‚` 
    );
  } else if(s26.clarity){
    add(
      `Your power move is simplification: fewer goals, cleaner inputs, faster feedback. Eliminate one recurring task that doesn't serve your highest purpose.`,
      `ä½ çš„ç‹ç‰Œæ˜¯â€œåšå‡æ³•â€ï¼šç›®æ ‡æ›´å°‘ï¼Œè¾“å…¥æ›´å¹²å‡€ï¼Œåé¦ˆå›è·¯æ›´å¿«ã€‚åˆ æ‰ä¸€ä¸ªä¸å†æœåŠ¡äºä½ æœ€é«˜ç›®æ ‡ã€åˆé‡å¤å‡ºç°çš„ä»»åŠ¡ã€‚` 
    );
  } else {
    add(
      `Consistency will do the heavy lifting: tiny daily effort beats occasional intensity. Find the minimum viable effort you can sustain, and stick to it daily.`,
      `â€œç¨³å®šâ€ä¼šæ›¿ä½ æ‰›å¤§éƒ¨åˆ†å‹åŠ›ï¼šæ¯å¤©ä¸€ç‚¹ç‚¹ï¼Œæ¯”å¶å°”çˆ†å‘æ›´æœ‰ç”¨ã€‚æ‰¾åˆ°ä½ èƒ½æŒç»­çš„â€œæœ€ä½å¯è¡ŒåŠªåŠ›é‡â€ï¼Œç„¶åæ¯å¤©åšæŒã€‚` 
    );
  }
  return moves.slice(0,3);
}


function getQuote(cardNameEN, goal, lang) {
    const g = goal.toLowerCase();
    
    // --- Quote Database ---
    const quotes = {
        
        "The Fool": {
            "money": {
                en: "The first step toward financial freedom is simply deciding to start the journey, even without a perfect plan.",
                zh: "é€šå¾€è´¢åŠ¡è‡ªç”±çš„ç¬¬ä¸€æ­¥ï¼Œå°±æ˜¯æœæ–­å†³å®šå‡ºå‘ï¼Œå³ä½¿ä½ æ‰‹ä¸­è¿˜æ²¡æœ‰å®Œç¾çš„åœ°å›¾ã€‚",
            },
            "self-growth": {
                en: "Don't wait for permission to be the person you're meant to be. The lesson is in the leap.",
                zh: "ä¸å¿…ç­‰å¾…åˆ«äººçš„è®¸å¯ã€‚å»æˆä¸ºé‚£ä¸ªä½ æ³¨å®šè¦æˆä¸ºçš„äººï¼Œç­”æ¡ˆå°±åœ¨ä½ å‹‡æ•¢çš„è·¨è¶Šä¹‹ä¸­ã€‚",
            },
            "adventure": {
                en: "Take the path that holds the most unknowns. Trust the universe, but remember to look where you step!",
                zh: "é€‰æ‹©é‚£æ¡æ‹¥æœ‰æœ€å¤šæœªçŸ¥æ•°çš„é“è·¯ã€‚ç›¸ä¿¡å®‡å®™ï¼Œä½†ä¹Ÿè¦è®°å¾—çœ‹æ¸…è„šä¸‹çš„æ¯ä¸€æ­¥ï¼",
            },
            "default": {
                en: "The beginning is the most important part of the work. Leave your heavy luggage behind.",
                zh: "å¼€å§‹æ˜¯å·¥ä½œä¸­æœ€é‡è¦çš„éƒ¨åˆ†ã€‚è¯·æ”¾ä¸‹æ²‰é‡çš„è¡Œå›Šï¼Œè½»è£…ä¸Šé˜µã€‚",
            },
        },

        "The Magician": {
            "career": {
                en: "The resources you need are already within your reach. Focus your will and turn thought into manifestation.",
                zh: "ä½ éœ€è¦çš„èµ„æºæ—©å·²åœ¨ä½ è§¦æ‰‹å¯åŠä¹‹å¤„ã€‚èšç„¦ä½ çš„æ„å¿—åŠ›ï¼Œå°†æƒ³æ³•è½¬åŒ–ä¸ºç°å®çš„æ˜¾åŒ–ã€‚",
            },
            "growth": {
                en: "Don't wait for perfect inspiration; start with the tools you have. Skill is the link between desire and result.",
                zh: "ä¸è¦ç­‰å¾…å®Œç¾çš„çµæ„Ÿï¼›åˆ©ç”¨ä½ ç°æœ‰çš„å·¥å…·å¼€å§‹è¡ŒåŠ¨ã€‚æŠ€èƒ½æ˜¯æ¬²æœ›ä¸ç»“æœä¹‹é—´çš„è¿æ¥ã€‚",
            },
            "default": {
                en: "The moment of power is now. Stop preparing and start doingâ€”your capability is real.",
                zh: "åŠ›é‡çš„æ—¶åˆ»å°±åœ¨å½“ä¸‹ã€‚åœæ­¢å‡†å¤‡ï¼Œå¼€å§‹è¡ŒåŠ¨å§â€”â€”ä½ çš„èƒ½åŠ›è¶³ä»¥å®ç°ç›®æ ‡ã€‚",
            },
        },

        "The High Priestess": {
            "clarity": {
                en: "The answer is not in external data, but in the silence between your thoughts. Trust what you know, not what you see.",
                zh: "ç­”æ¡ˆä¸åœ¨å¤–åœ¨æ•°æ®ä¸­ï¼Œè€Œåœ¨äºä½ æ€æƒ³ä¹‹é—´çš„é™é»˜ã€‚ç›¸ä¿¡ä½ çš„ç›´è§‰ï¼Œè€Œéä½ è‚‰çœ¼æ‰€è§ã€‚",
            },
            "connection": {
                en: "Seek depth over quantity. Your quiet, internal world is the magnet for genuine connection.",
                zh: "å¯»æ±‚æ·±åº¦ï¼Œè€Œéæ•°é‡ã€‚ä½ å®é™çš„å†…åœ¨ä¸–ç•Œï¼Œæ‰æ˜¯å¸å¼•çœŸè¯šè¿ç»“çš„ç£çŸ³ã€‚",
            },
            "default": {
                en: "Retreat into the sacred space of your own mind. Less noise, more signal.",
                zh: "é€€å›åˆ°ä½ è‡ªå·±å¿ƒçµçš„åœ£åœ°ã€‚å‡å°‘å¤–ç•Œå¹²æ‰°ï¼Œæ•æ‰å†…å¿ƒæœ€å®‰é™çš„ä¿¡å·ã€‚",
            },
        },

        "The Empress": {
            "health": {
                en: "Nourishment is not just food; itâ€™s beauty, rest, and sensory pleasure. Build a routine that truly nurtures life.",
                zh: "æ»‹å…»ä¸ä»…ä»…æ˜¯é£Ÿç‰©ï¼›å®ƒåŒ…æ‹¬ç¾ã€ä¼‘æ¯å’Œæ„Ÿå®˜æ„‰æ‚¦ã€‚å»ºç«‹çœŸæ­£æ»‹å…»ç”Ÿå‘½çš„æ—¥å¸¸ä¹ æƒ¯ã€‚",
            },
            "money": {
                en: "Abundance flows when you care for yourself and your environment. Creativity is your most fertile asset.",
                zh: "å½“ä½ ç…§é¡¾å¥½è‡ªå·±å’Œå‘¨å›´ç¯å¢ƒæ—¶ï¼Œä¸°ç››å°±ä¼šè‡ªç„¶æµæ·Œã€‚åˆ›é€ åŠ›æ˜¯ä½ æœ€è‚¥æ²ƒçš„èµ„äº§ã€‚",
            },
            "default": {
                en: "Cultivate beauty and patience. Everything you tend to, including yourself, is ready to bloom.",
                zh: "åŸ¹å…»ç¾æ„Ÿå’Œè€å¿ƒã€‚ä½ æ‰€ç…§æ–™çš„ä¸€åˆ‡ï¼ŒåŒ…æ‹¬ä½ è‡ªå·±ï¼Œéƒ½å·²å‡†å¤‡å¥½ç»½æ”¾ã€‚",
            },
        },

        "The Emperor": {
            "career": {
                en: "Lead with strategic intention, not emotion. Establishing clear rules brings stability and respect.",
                zh: "ä»¥æˆ˜ç•¥æ„å›¾è€Œéæƒ…ç»ªæ¥é¢†å¯¼ã€‚å»ºç«‹æ¸…æ™°çš„è§„åˆ™ä¼šå¸¦æ¥ç¨³å®šå’Œå°Šé‡ã€‚",
            },
            "money": {
                en: "Your financial freedom requires structure. Create a rigid budget and stick to the boundaries you set.",
                zh: "ä½ çš„è´¢åŠ¡è‡ªç”±éœ€è¦ä¸¥è°¨çš„ç»“æ„ã€‚å»ºç«‹ä¸€ä¸ªä¸¥æ ¼çš„é¢„ç®—ï¼Œå¹¶åšå®ˆä½ è®¾å®šçš„ç•Œé™ã€‚",
            },
            "default": {
                en: "The foundation of mastery is discipline. Take charge, establish order, and let your authority be calm and firm.",
                zh: "ç²¾é€šçš„åŸºç¡€æ˜¯çºªå¾‹ã€‚æŒæ§å±€é¢ï¼Œå»ºç«‹ç§©åºï¼Œè®©ä½ çš„æƒå¨ä¿æŒå†·é™å’Œåšå®šã€‚",
            },
        },

        "The Hierophant": {
            "growth": {
                en: "Wisdom is often found in tradition. Seek formalized learning or mentorship before attempting radical change.",
                zh: "æ™ºæ…§å¾€å¾€å­˜åœ¨äºä¼ ç»Ÿä¹‹ä¸­ã€‚åœ¨å°è¯•æ¿€è¿›çš„æ”¹å˜ä¹‹å‰ï¼Œè¯·å¯»æ±‚æ­£å¼çš„å­¦ä¹ æˆ–å¯¼å¸ˆçš„æŒ‡å¯¼ã€‚",
            },
            "connection": {
                en: "Find common ground through shared rituals or values. True community offers a sense of belonging and guidance.",
                zh: "é€šè¿‡å…±åŒçš„ä»ªå¼æˆ–ä»·å€¼è§‚å¯»æ‰¾å…±åŒç‚¹ã€‚çœŸæ­£çš„ç¤¾ç¾¤èƒ½æä¾›å½’å±æ„Ÿå’ŒæŒ‡å¼•ã€‚",
            },
            "default": {
                en: "Respect the system, but question its origin. Honor tradition while finding your own ethical truth within it.",
                zh: "å°Šé‡ä½“åˆ¶ï¼Œä½†è´¨ç–‘å…¶èµ·æºã€‚åœ¨å°Šé‡ä¼ ç»Ÿçš„åŒæ—¶ï¼Œåœ¨å…¶ä¸­æ‰¾åˆ°ä½ è‡ªå·±çš„é“å¾·çœŸç†ã€‚",
            },
        },

        "The Lovers": {
            "love": {
                en: "The deepest bond is built on shared values. Choose what honors your truth, even if it means saying no to convenience.",
                zh: "æœ€æ·±åšçš„è¿ç»“æ˜¯å»ºç«‹åœ¨å…±åŒä»·å€¼è§‚ä¹‹ä¸Šçš„ã€‚é€‰æ‹©å¿ äºä½ çš„çœŸå®ï¼Œå³ä½¿è¿™æ„å‘³ç€æ”¾å¼ƒä¾¿åˆ©ã€‚",
            },
            "career": {
                en: "Align your work with your deepest convictions. If you face a choice, let your ethics be the deciding factor.",
                zh: "è®©ä½ çš„å·¥ä½œä¸ä½ æœ€æ·±å±‚çš„ä¿¡å¿µå¯¹é½ã€‚å¦‚æœä½ é¢ä¸´é€‰æ‹©ï¼Œè®©ä½ çš„é“å¾·ä¼¦ç†æˆä¸ºå†³å®šæ€§å› ç´ ã€‚",
            },
            "default": {
                en: "Trust your discipline. The path is clear and your willpower is enough to achieve the impossible.",
                zh: "ç›¸ä¿¡ä½ çš„è‡ªå¾‹ã€‚é“è·¯å¾ˆæ¸…æ™°ï¼Œä½ çš„æ„å¿—åŠ›è¶³ä»¥å®ç°çœ‹ä¼¼ä¸å¯èƒ½çš„ç›®æ ‡ã€‚",
            },
        },

        "The Chariot": {
            "ambition": {
                en: "Focused progress requires iron-clad boundaries. Use your discipline to accelerate your freedom, not restrict it.",
                zh: "èšç„¦çš„è¿›æ­¥éœ€è¦é’¢é“èˆ¬çš„ç•Œé™ã€‚ç”¨ä½ çš„è‡ªå¾‹æ¥åŠ é€Ÿä½ çš„è‡ªç”±ï¼Œè€Œä¸æ˜¯é™åˆ¶å®ƒã€‚",
            },
            "adventure": {
                en: "Itâ€™s time to move. Committing to a clear destination turns wanderlust into purpose.",
                zh: "æ˜¯æ—¶å€™è¡ŒåŠ¨äº†ã€‚å¯¹ä¸€ä¸ªæ˜ç¡®ç›®çš„åœ°çš„æ‰¿è¯ºï¼Œå°†ä½ çš„æ¼«æ¸¸æ¬²æœ›è½¬åŒ–ä¸ºç›®æ ‡ã€‚",
            },
            "default": {
                en: "Trust your discipline. The path is clear and your willpower is enough to achieve the impossible.",
                zh: "ç›¸ä¿¡ä½ çš„è‡ªå¾‹ã€‚é“è·¯å¾ˆæ¸…æ™°ï¼Œä½ çš„æ„å¿—åŠ›è¶³ä»¥å®ç°çœ‹ä¼¼ä¸å¯èƒ½çš„ç›®æ ‡ã€‚",
            },
        },
        
        "Strength": {
            "health": {
                en: "True wellness comes from gentle consistency, not aggressive force. Treat your body with patience and kindness.",
                zh: "çœŸæ­£çš„å¥åº·æ¥è‡ªäºæ¸©å’Œçš„æŒç»­æ€§ï¼Œè€Œéæ¿€è¿›çš„å¼ºè¿«ã€‚è¯·ç”¨è€å¿ƒå’Œå–„è‰¯å¯¹å¾…ä½ çš„èº«ä½“ã€‚",
            },
            "growth": {
                en: "Face your greatest fear not with a roar, but with a quiet, unshakeable calm. Compassion is the highest form of power.",
                zh: "é¢å¯¹ä½ æœ€å¤§çš„ææƒ§ï¼Œä¸æ˜¯é å’†å“®ï¼Œè€Œæ˜¯é ä¸€ç§å¹³é™ã€åšä¸å¯æ‘§çš„æ²‰ç€ã€‚æ…ˆæ‚²æ˜¯åŠ›é‡çš„æœ€é«˜å½¢å¼ã€‚",
            },
            "default": {
                en: "Your greatest power is not found in controlling others, but in mastering yourself through kindness.",
                zh: "ä½ æœ€å¤§çš„åŠ›é‡ä¸åœ¨äºæ§åˆ¶ä»–äººï¼Œè€Œåœ¨äºé€šè¿‡å–„è‰¯æ¥é©¾é©­ä½ è‡ªå·±ã€‚",
            },
        },

        "The Hermit": {
            "clarity": {
                en: "Step away from the noise. The clarity you seek is found only in the quiet of your own counsel.",
                zh: "è¿œç¦»å–§åš£ã€‚ä½ æ‰€å¯»æ±‚çš„æ¸…æ™°æ´å¯ŸåŠ›ï¼Œåªèƒ½åœ¨ä½ å†…å¿ƒçš„å®‰é™ç‹¬å¤„ä¸­æ‰¾åˆ°ã€‚",
            },
            "growth": {
                en: "True wisdom is not taught, but realized through deep reflection. Turn inward to evolve outward.",
                zh: "çœŸæ­£çš„æ™ºæ…§ä¸æ˜¯æ•™å‡ºæ¥çš„ï¼Œè€Œæ˜¯é€šè¿‡æ·±åº¦å†…çœè€Œå®ç°çš„ã€‚å‘å†…è½¬ï¼Œæ‰èƒ½å‘å¤–è¿›åŒ–ã€‚",
            },
            "default": {
                en: "Retreat is not weakness; it is a necessary strategy. Use this solitude to refine your next move.",
                zh: "é€€éšå¹¶éè½¯å¼±ï¼›å®ƒæ˜¯ä¸€ç§å¿…è¦çš„ç­–ç•¥ã€‚åˆ©ç”¨è¿™æ®µç‹¬å¤„æ¥å®Œå–„ä½ çš„ä¸‹ä¸€æ­¥è¡ŒåŠ¨ã€‚",
            },
        },

        "Wheel of Fortune": {
            "money": {
                en: "A financial cycle is concluding. Be flexible and ready to seize the opportunity that arrives with the turning of the wheel.",
                zh: "ä¸€ä¸ªè´¢åŠ¡å‘¨æœŸå³å°†ç»“æŸã€‚ä¿æŒçµæ´»ï¼Œå¹¶å‡†å¤‡å¥½æŠ“ä½å‘½è¿ä¹‹è½®è½¬åŠ¨æ—¶å¸¦æ¥çš„æœºä¼šã€‚",
            },
            "growth": {
                en: "Luck favors the prepared mind. Adapt quickly to the current shift and recognize the opportunity in the change.",
                zh: "è¿æ°”åçˆ±æœ‰å‡†å¤‡çš„å¤´è„‘ã€‚è¿…é€Ÿé€‚åº”å½“å‰çš„è½¬å˜ï¼Œå¹¶è¯†åˆ«å˜åŒ–ä¸­çš„æœºé‡ã€‚",
            },
            "default": {
                en: "Change is the only constant. Release your grip on the past and trust the cycle is moving in your favor.",
                zh: "å˜åŒ–æ˜¯å”¯ä¸€çš„æ°¸æ’ã€‚æ”¾ä¸‹å¯¹è¿‡å»çš„æ‰§ç€ï¼Œç›¸ä¿¡å‘¨æœŸæ­£æœç€æœ‰åˆ©äºä½ çš„æ–¹å‘è½¬åŠ¨ã€‚",
            },
        },

        "Justice": {
            "connection": {
                en: "Your relationship success hinges on fair exchange. Set clean boundaries and honor your own value.",
                zh: "å…³ç³»çš„æˆåŠŸå–å†³äºå…¬å¹³çš„äº¤æ¢ã€‚åˆ’æ¸…ç•Œé™ï¼Œå¹¶çœŸè¯šåœ°å°Šé‡ä½ è‡ªèº«çš„ä»·å€¼ã€‚",
            },
            "career": {
                en: "Align your work with your integrity. You gain power not through compromise, but through conviction.",
                zh: "è®©ä½ çš„å·¥ä½œä¸ä½ çš„æ­£ç›´ç›¸ä¸€è‡´ã€‚ä½ é€šè¿‡ä¿¡å¿µè·å¾—åŠ›é‡ï¼Œè€Œéå¦¥åã€‚",
            },
            "default": {
                en: "What you reinforce becomes real. Be meticulously fair to yourself first, then to others.",
                zh: "ä½ æ‰€å¼ºåŒ–çš„ä¸œè¥¿ä¼šæˆä¸ºç°å®ã€‚è¯·å…ˆå¯¹ä½ è‡ªå·±å…¬æ­£ï¼Œç„¶åæ‰æ˜¯å¯¹å¾…ä»–äººã€‚",
            },
        },

        "The Hanged Man": {
            "clarity": {
                en: "Clarity requires a pause. Stop pushing forward and embrace a moment of suspended action to see the truth.",
                zh: "æ¸…æ™°éœ€è¦æš‚åœã€‚åœæ­¢å‘å‰æ¨è¿›ï¼Œæ‹¥æŠ±è¿™æ®µæ‚¬æµ®çš„æ—¶åˆ»ï¼Œä½ æ‰èƒ½çœ‹æ¸…çœŸç›¸ã€‚",
            },
            "growth": {
                en: "The greatest growth comes from choosing to see the world from an entirely inverted perspective.",
                zh: "æœ€å¤§çš„æˆé•¿æ¥è‡ªäºé€‰æ‹©ä»¥ä¸€ä¸ªå®Œå…¨é¢ å€’çš„è§†è§’æ¥çœ‹å¾…è¿™ä¸ªä¸–ç•Œã€‚",
            },
            "default": {
                en: "Release your attachment to the way things 'should' be. True power is found in surrender, not control.",
                zh: "æ”¾ä¸‹ä½ å¯¹äº‹ç‰©â€œåº”è¯¥å¦‚ä½•â€çš„æ‰§ç€ã€‚çœŸæ­£çš„åŠ›é‡åœ¨äºè‡£æœï¼Œè€Œéæ§åˆ¶ã€‚",
            },
        },

        "Death": {
            "connection": {
                en: "You cannot carry old baggage into new relationships. Release the past, and make space for genuine connection.",
                zh: "ä½ æ— æ³•å¸¦ç€æ—§åŒ…è¢±è¿›å…¥æ–°çš„å…³ç³»ã€‚æ”¾ä¸‹è¿‡å»ï¼Œæ‰èƒ½ä¸ºçœŸè¯šçš„è¿ç»“è…¾å‡ºç©ºé—´ã€‚",
            },
            "ambition": {
                en: "For powerful progress, you must eliminate one commitment that no longer serves your true ambition.",
                zh: "è¦æƒ³å®ç°å¼ºå¤§çš„è¿›æ­¥ï¼Œä½ å¿…é¡»æœæ–­ç»ˆæ­¢ä¸€ä¸ªä¸å†æœåŠ¡äºä½ çœŸæ­£é‡å¿ƒçš„æ‰¿è¯ºã€‚",
            },
            "default": {
                en: "The ending is not failure, but necessary change. Embrace the space created by your goodbyes.",
                zh: "ç»“æŸå¹¶éå¤±è´¥ï¼Œè€Œæ˜¯å¿…ç„¶çš„æ”¹å˜ã€‚æ‹¥æŠ±ä½ å‹‡æ•¢å‘Šåˆ«åæ‰€åˆ›é€ å‡ºçš„å·¨å¤§ç©ºé—´ã€‚",
            },
        },

        "Temperance": {
            "health": {
                en: "Rhythm is your greatest medicine. Seek balance not through drastic change, but through steady, small adjustments.",
                zh: "èŠ‚å¥æ˜¯ä½ æœ€å¥½çš„è¯ç‰©ã€‚é€šè¿‡ç¨³å®šã€å¾®å°çš„ä¿®æ­£æ¥å¯»æ±‚å¹³è¡¡ï¼Œè€Œéå·¨å¤§çš„æ”¹å˜ã€‚",
            },
            "growth": {
                en: "To evolve without burnout, learn to blend disparate ideas. The power is in synthesis, not acceleration.",
                zh: "è‹¥æƒ³é¿å…ç²¾ç–²åŠ›å°½è€ŒæŒç»­è¿›åŒ–ï¼Œè¯·å­¦ä¼šèåˆä¸åŒçš„æƒ³æ³•ã€‚åŠ›é‡åœ¨äºç»¼åˆï¼Œè€ŒéåŠ é€Ÿã€‚",
            },
            "default": {
                en: "There is no rush. Find the perfect flow state between too much and too little.",
                zh: "æ— éœ€ç€æ€¥ã€‚åœ¨â€œå¤ªå¤šâ€å’Œâ€œå¤ªå°‘â€ä¹‹é—´ï¼Œæ‰¾åˆ°é‚£ä¸ªå®Œç¾çš„æµåŠ¨çŠ¶æ€ã€‚",
            },
        },

        "The Devil": {
            "money": {
                en: "Identify where your financial decisions are driven by fear or materialism, not true need. You hold the key to freedom.",
                zh: "è®¤æ¸…ä½ çš„è´¢åŠ¡å†³ç­–æ˜¯å—ææƒ§æˆ–ç‰©è´¨æ¬²æœ›é©±åŠ¨ï¼Œè€ŒéçœŸå®éœ€æ±‚ã€‚æŒ£è„±çš„é’¥åŒ™å°±åœ¨ä½ è‡ªå·±æ‰‹ä¸­ã€‚",
            },
            "connection": {
                en: "Break the cycle of codependency or toxic attachment. Freedom is an act of self-respect.",
                zh: "æ‰“ç ´ç›¸äº’ä¾èµ–æˆ–æœ‰æ¯’ä¾æ‹çš„å¾ªç¯ã€‚è‡ªç”±æ˜¯ä¸€ç§è‡ªæˆ‘å°Šé‡çš„è¡Œä¸ºã€‚",
            },
            "default": {
                en: "Your habits are your chains. Today is the day to name the obsession and take the first step toward self-liberation.",
                zh: "ä½ çš„ä¹ æƒ¯å°±æ˜¯ä½ çš„æ·é”ã€‚ä»Šå¤©ï¼Œè¯·è¯´å‡ºé‚£å›°æ‰°ä½ çš„æ‰§å¿µï¼Œå¹¶è¿ˆå‡ºè‡ªæˆ‘è§£æ”¾çš„ç¬¬ä¸€æ­¥ã€‚",
            },
        },

        "The Tower": {
            "stability": {
                en: "The illusion of safety is shattering. Though chaotic, this upheaval is purifying and necessary for rebuilding on solid ground.",
                zh: "å®‰å…¨çš„å¹»è§‰æ­£åœ¨ç ´ç¢ã€‚å°½ç®¡æ··ä¹±ï¼Œè¿™æ¬¡å‰§å˜æ˜¯å‡€åŒ–æ€§çš„ï¼Œå¯¹äºåœ¨åšå®çš„åŸºç¡€ä¸Šé‡å»ºè‡³å…³é‡è¦ã€‚",
            },
            "growth": {
                en: "Radical clarity follows radical destruction. What falls now was destined to collapse. Embrace the space it creates.",
                zh: "å½»åº•çš„æ¸…æ™°åº¦ä¼´éšç€å½»åº•çš„æ‘§æ¯ã€‚ç°åœ¨å€’å¡Œçš„ç»“æ„æ˜¯æ³¨å®šè¦å´©æºƒçš„ã€‚æ‹¥æŠ±å®ƒæ‰€åˆ›é€ çš„ç©ºé—´ã€‚",
            },
            "default": {
                en: "The collapse is not punishment, but liberation. Let go and let the truth be your guide.",
                zh: "å´©å¡Œå¹¶éæƒ©ç½šï¼Œè€Œæ˜¯è§£æ”¾ã€‚æ”¾æ‰‹å§ï¼Œè®©çœŸç›¸æˆä¸ºä½ çš„æŒ‡å¼•ã€‚",
            },
        },

        "The Star": {
            "love": {
                en: "The greatest discovery is that you don't have to choose between finding yourself and finding love. Both are possible now.",
                zh: "æœ€å¤§çš„é¢†æ‚Ÿæ˜¯ï¼šä½ æ— éœ€åœ¨â€œæ‰¾åˆ°è‡ªæˆ‘â€å’Œâ€œå¯»æ‰¾çˆ±â€ä¹‹é—´åšé€‰æ‹©ã€‚æ­¤åˆ»ï¼Œä¸¤è€…çš†å¯å®ç°ã€‚",
            },
            "health": {
                en: "Healing is not a one-time event, but a system of small, hopeful habits you build daily.",
                zh: "ç–—æ„ˆä¸æ˜¯ä¸€æ¬¡æ€§äº‹ä»¶ï¼Œè€Œæ˜¯ä½ æ¯æ—¥å»ºç«‹èµ·æ¥çš„ä¸€å¥—å……æ»¡å¸Œæœ›çš„å°ä¹ æƒ¯ç³»ç»Ÿã€‚",
            },
            "default": {
                en: "Your faith in the future is your best asset. Tend to your garden; the seeds are good.",
                zh: "ä½ å¯¹æœªæ¥çš„ä¿¡å¿µï¼Œæ˜¯ä½ æœ€å®è´µçš„èµ„äº§ã€‚ç…§çœ‹å¥½ä½ çš„å†…åœ¨èŠ±å›­ï¼›ç§å­æ˜¯å¥½çš„ã€‚",
            },
        },

        "The Moon": {
            "clarity": {
                en: "Logic is misleading right now. Trust the uneasy feeling in your gutâ€”your intuition is seeing through the illusion.",
                zh: "é€»è¾‘æ­¤åˆ»ä¼šäº§ç”Ÿè¯¯å¯¼ã€‚ç›¸ä¿¡ä½ å†…åœ¨ä¸å®‰çš„ç›´è§‰â€”â€”å®ƒæ­£åœ¨ç©¿é€çœ¼å‰çš„å¹»è±¡ã€‚",
            },
            "self-growth": {
                en: "Do not fear the darkness or the unknown parts of yourself. Your shadow holds untapped creative power.",
                zh: "ä¸è¦å®³æ€•é»‘æš—æˆ–æœªçŸ¥çš„è‡ªæˆ‘ã€‚ä½ çš„é˜´å½±ä¸­è•´è—ç€æœªè¢«å¼€å‘å‡ºçš„å·¨å¤§åˆ›é€ åŠ›ã€‚",
            },
            "default": {
                en: "The path is unclear because you are meant to navigate by instinct. Wait for the fog to lift before making major moves.",
                zh: "é“è·¯ä¹‹æ‰€ä»¥æ¨¡ç³Šï¼Œæ˜¯å› ä¸ºä½ éœ€è¦é æœ¬èƒ½æ¥å¯¼èˆªã€‚åœ¨è¿·é›¾æ¶ˆæ•£ä¹‹å‰ï¼Œè¯·å‹¿åšå‡ºé‡å¤§å†³ç­–ã€‚",
            },
        },

        "The Sun": {
            "love": {
                en: "You are the light you've been waiting for. Authentic joy is irresistibleâ€”let it shine without apology.",
                zh: "ä½ å°±æ˜¯ä½ ä¸€ç›´åœ¨ç­‰å¾…çš„å…‰ã€‚çœŸæ­£çš„å–œæ‚¦æ˜¯æ— æ³•æŠ—æ‹’çš„â€”â€”è¯·æ¯«æ— ä¿ç•™åœ°é—ªè€€å§ã€‚",
            },
            "ambition": {
                en: "Clarity beats hustle. Commit to one clear goal and proceed with absolute, joyful confidence.",
                zh: "æ¸…æ™°èƒœè¿‡å¿™ç¢Œã€‚ç¡®å®šä¸€ä¸ªæ˜ç¡®ç›®æ ‡ï¼Œä»¥ç»å¯¹çš„ã€å……æ»¡å–œæ‚¦çš„è‡ªä¿¡å‘å‰æ¨è¿›ã€‚",
            },
            "default": {
                en: "True confidence comes from being seen exactly as you are. Stop hiding your innate warmth.",
                zh: "çœŸæ­£çš„è‡ªä¿¡æºäºè¢«å¦‚å®åœ°çœ‹è§ã€‚åœæ­¢éšè—ä½ ä¸ç”Ÿä¿±æ¥çš„å…‰èŠ’å’Œæ¸©æš–ã€‚",
            },
        },

        "Judgement": {
            "career": {
                en: "You are being called to a higher purpose in your work. Stop comparing yourself and start answering the call that only you hear.",
                zh: "ä½ çš„å·¥ä½œæ­£è¢«å¬å”¤åˆ°ä¸€ä¸ªæ›´é«˜çš„ä½¿å‘½ã€‚åœæ­¢ä¸ä»–äººæ¯”è¾ƒï¼Œå¼€å§‹å›åº”åªæœ‰ä½ è‡ªå·±èƒ½å¬åˆ°çš„å¬å”¤ã€‚",
            },
            "self-growth": {
                en: "Forgive yourself for the past. True self-acceptance is the launchpad for your next great awakening.",
                zh: "å®½æ•è¿‡å»çš„è‡ªå·±ã€‚çœŸæ­£çš„è‡ªæˆ‘æ¥çº³ï¼Œæ˜¯ä½ ä¸‹ä¸€ä¸ªä¼Ÿå¤§è§‰é†’çš„å¯åŠ¨å¹³å°ã€‚",
            },
            "default": {
                en: "A spiritual or personal reckoning is here. The final verdict on your life is only given by your own conscience.",
                zh: "ä¸€æ¬¡ç²¾ç¥æˆ–ä¸ªäººçš„æ¸…ç®—å·²ç»åˆ°æ¥ã€‚å¯¹ä½ äººç”Ÿçš„æœ€ç»ˆè£å†³ï¼Œåªèƒ½ç”±ä½ è‡ªå·±çš„è‰¯çŸ¥ç»™å‡ºã€‚",
            },
        },

        "The World": {
            "career": {
                en: "You have completed a major cycle of achievement. Now, integrate the lessons learned and prepare to expand your influence globally.",
                zh: "ä½ å·²ç»å®Œæˆäº†ä¸€ä¸ªä¸»è¦çš„æˆå°±å‘¨æœŸã€‚ç°åœ¨ï¼Œæ•´åˆæ‰€å­¦çš„ç»éªŒæ•™è®­ï¼Œå¹¶å‡†å¤‡æ‰©å¤§ä½ çš„å½±å“èŒƒå›´ã€‚",
            },
            "growth": {
                en: "Completion is not the end, but the earned right to level up. You have the skills to move to the next great stage.",
                zh: "åœ†æ»¡ä¸æ˜¯ç»ˆç‚¹ï¼Œè€Œæ˜¯å‡çº§çš„æƒåˆ©ã€‚ä½ å·²å…·å¤‡æŠ€èƒ½è¿ˆå‘ä¸‹ä¸€ä¸ªä¼Ÿå¤§çš„é˜¶æ®µã€‚",
            },
            "default": {
                en: "The world is yours. Celebrate your victory, recognize the wholeness of your journey, and feel utterly fulfilled.",
                zh: "ä¸–ç•Œæ˜¯ä½ çš„ã€‚åº†ç¥ä½ çš„èƒœåˆ©ï¼Œè®¤å¯ä½ æ—…ç¨‹çš„å®Œæ•´æ€§ï¼Œå¹¶æ„Ÿå—å½»åº•çš„åœ†æ»¡ã€‚",
            },
        },
    };

    // --- Quote Selection Logic ---
    const cardQuotes = quotes[cardNameEN]; 
    if (!cardQuotes) {
        // Fallback for missing card or error (uses a general message)
        const fallback = lang === "zh" ? "å¹´åº¦æŒ‡å¼•ï¼šä½ çš„æ ¸å¿ƒä¼˜åŠ¿æ­£åœ¨æµ®ç°ï¼Œç°åœ¨æ˜¯æ—¶å€™ä¸“æ³¨äºä½ çš„ä¸»ç›®æ ‡äº†ã€‚" : "Annual Guidance: Your core advantages are emerging, now is the time to focus on your top goal.";
        return fallback;
    }
    
    const quote = cardQuotes[g] || cardQuotes["default"];

    return lang === "zh" ? quote.zh : quote.en;
}


function buildReading(profile, cards){
    const who = profile.name ? profile.name : (LANG==="zh" ? "ä½ " : "you");
    const zf = zodiacFlavor(profile.zodiac);
    const zzh = zodiacNameZH(profile.zodiac);
    const mp = microProfile(profile);
    const moves = comboInsight(cards, profile);

    const idLineEN = `You: ${who} â€¢ Age ${profile.age} â€¢ ${cap(profile.zodiac)}${zzh?` (${zzh})`:``}${profile.mbti?` â€¢ ${profile.mbti.toUpperCase()}`:""} â€¢ Goal: ${cap(profile.goal)}`;
    const idLineZH = `ä½ ï¼š${who}ï½œ${profile.age}å²ï½œ${cap(profile.zodiac)}ï¼ˆ${zzh}ï¼‰${profile.mbti?`ï½œ${profile.mbti.toUpperCase()}`:""}ï½œä¸»ç›®æ ‡ï¼š${cap(profile.goal)}`;

    const cardLineEN = `Spread: ${cards.map(c=>c.nameEN).join(" â†’ ")}.`;
    const cardLineZH = `ç‰Œé˜µï¼š${cards.map(c=>c.nameZH).join(" â†’ ")}ã€‚`;

    const zLineEN = `Constellation vibe: ${cap(profile.zodiac)} leans toward ${zf.en}.`;
    const zLineZH = `æ˜Ÿåº§æ°”è´¨ï¼š${cap(profile.zodiac)} æ›´åã€Œ${zf.zh}ã€ã€‚`;

    const futureCardNameEN = cards[2].nameEN;
    const futureCardNameZH = cards[2].nameZH;
    const goal = profile.goal;
    const personalizedQuote = getQuote(futureCardNameEN, goal, LANG);

    const oneLinerEN = `Your Guidance (Card of 2026: ${futureCardNameEN}): ${personalizedQuote}`;
    const oneLinerZH = `26 å¹´æŒ‡å¼•ï¼ˆå…³é”®ç‰Œï¼š${futureCardNameZH}ï¼‰ï¼š${personalizedQuote}`;

    const goalLineEN = `Main quest lens: ${goalLens(profile.goal)}.`;
    const goalLineZH = `ä¸»çº¿è§†è§’ï¼š${goalLens(profile.goal)}ã€‚`;

    return {
        idLineEN, idLineZH,
        cardLineEN, cardLineZH,
        zLineEN, zLineZH,
        microEN: (LANG==="zh" ? "" : mp),
        microZH: (LANG==="zh" ? mp : ""),
        goalLineEN, goalLineZH,
        moves,
        oneLinerEN,
        oneLinerZH
    };
}

function renderReading(reading){
  const mk = (title, html) => `
    <div class="section">
      <div class="secTitle">${title}</div>
      <div class="p">${html}</div>
    </div>
  `;

  const idLine = (LANG==="zh") ? reading.idLineZH : reading.idLineEN;
  const cardLine = (LANG==="zh") ? reading.cardLineZH : reading.cardLineEN;
  const zLine = (LANG==="zh") ? reading.zLineZH : reading.zLineEN;
  const micro = (LANG==="zh") ? reading.microZH : reading.microEN;
  const goalLine = (LANG==="zh") ? reading.goalLineZH : reading.goalLineEN;

  const movesHtml = `
    <ul>
      ${reading.moves.map(m => `<li>${LANG==="zh" ? m.zh : m.en}</li>`).join("")}
    </ul>
  `;

  readingContent.innerHTML = `
    ${mk(LANG==="zh" ? "ä¸ªäººç”»åƒ" : "Who this reading is for", `${idLine}<br/>${cardLine}`)}
    ${mk(LANG==="zh" ? "æ ¸å¿ƒè§£è¯»" : "Your current vibe", `${micro}<br/>${zLine}<br/>${goalLine}`)}
    ${mk(LANG==="zh" ? "å°å»ºè®®" : "Next steps for you", movesHtml)}
  `;

  document.getElementById("disclaimer").textContent = t[LANG].disclaimer;
}

/* =========================================================
   RENDER CARDS (flip) + spacing not cut
   ========================================================= */

function renderCards(cards){
  cardsEl.innerHTML = "";
  const labelsEN = ["Past Year (2025)", "Present (Right Now)", "Upcoming Year (2026)"];
  const labelsZH = ["å›é¡¾è¿‡å»ä¸€å¹´", "å½“ä¸‹ä½ çš„ç«‹è¶³ç‚¹", "å±•æœ›2026"];

cards.forEach((c, i)=>{
    const outer = document.createElement("div");
    outer.className = "flip";
    outer.innerHTML = `
      <div class="flipInner">
        <div class="face back"><div class="pattern"></div></div>
        <div class="face front">
          <div class="frontTop">
            <div class="label-group">
              <div class="time-label">${LANG==="zh" ? labelsZH[i] : labelsEN[i]}</div>
              <div class="vibe-label"><strong>${LANG==="zh" ? c.vibeZH : c.vibeEN}</strong></div>
            </div>
          </div>
          <div class="art"><img alt="tarot" src="${c.img}"/></div>
          <div class="frontBody">
            <div class="name">${LANG==="zh" ? c.nameZH : c.nameEN}</div>
            <p class="meaning">${LANG==="zh" ? c.baseZH : c.baseEN}</p>
          </div>
        </div>
      </div>
    `;
    cardsEl.appendChild(outer);
    setTimeout(()=>outer.classList.add("revealed"), 280 + i*220);
  });
}

/* =========================================================
   CHIPS (includes zodiac bilingual)
   ========================================================= */
function setChips(profile, cards){
  chipsEl.innerHTML = "";
  const { selfWords, hopeWords, goal, mbti, zodiac, age } = profile;
  const zzh = zodiacNameZH(zodiac);

  const items = [];
  selfWords.forEach(w => items.push(`${w}Â·2025`));
  hopeWords.forEach(w => items.push(`${w}Â·2026`));

  items.push(LANG==="zh" ? `ç›®æ ‡Â·${cap(goal)}` : `GoalÂ·${cap(goal)}`);
  items.push(LANG==="zh" ? `å¹´é¾„Â·${age}` : `AgeÂ·${age}`);
  items.push(LANG==="zh" ? `æ˜Ÿåº§Â·${cap(zodiac)}ï¼ˆ${zzh}ï¼‰` : `ZodiacÂ·${cap(zodiac)} (${zzh})`);
  if(mbti) items.push(`MBTIÂ·${mbti.toUpperCase().trim()}`);

  cards.forEach(c => items.push(LANG==="zh" ? c.nameZH : c.nameEN));

  items.slice(0, 18).forEach(txt=>{
    const chip = document.createElement("div");
    chip.className="chip";
    chip.textContent = txt;
    chipsEl.appendChild(chip);
  });
}

/* =========================================================
   LOCK 2025 words after first generate
   ========================================================= */
function lockSelfWords(lock){
  STATE.lockedSelf = !!lock;
  selfInput.disabled = STATE.lockedSelf;
  if(STATE.lockedSelf){
    selfInput.value = (STATE.profile?.selfWords || []).join(", ");
    showToast(t[LANG].locked);
  }
}
function enforceSelfLock(){
  if(!STATE.lockedSelf) return;
  const locked = (STATE.profile?.selfWords || []).join(", ");
  if(selfInput.value !== locked) selfInput.value = locked;
}
["input","paste","keydown","keyup","change"].forEach(evt=>{
  selfInput.addEventListener(evt, enforceSelfLock);
});

/* =========================================================
   SHARE CARD TEXT (uses reading one-liner, not hard-coded)
   ========================================================= */
function shareText(profile, cards, reading){
  const goalCfg = goalDecor(profile.goal); 
  const gLabel = LANG==="zh" ? goalCfg.labelZH : goalCfg.labelEN;

  const who = profile.name ? profile.name : (LANG==="zh" ? "ä½ " : "You");
  const mb = (profile.mbti||"").toUpperCase().trim() || (LANG==="zh" ? "æ— " : "â€”");
  const zzh = zodiacNameZH(profile.zodiac);
  const z = `${cap(profile.zodiac)}${zzh? (LANG==="zh" ? `ï¼ˆ${zzh}ï¼‰` : ` (${zzh})`) : ""}`;
  const cNames = cards.map(c => LANG==="zh" ? c.nameZH : c.nameEN).join(" Â· ");
  const oneLiner = (LANG==="zh") ? reading.oneLinerZH : reading.oneLinerEN;

  if(LANG==="zh"){
    return [
      `å§“åï¼š${who}Â  ï½œ å¹´é¾„ï¼š${profile.age}Â  ï½œ æ˜Ÿåº§ï¼š${z}Â  ï½œ MBTIï¼š${mb}`,
Â  Â  Â  "", 
      `â€”`, 
      `2025 çŠ¶æ€å…³é”®è¯ï¼š${profile.selfWords.join("ã€")}`, 
      `2026 å†…åœ¨æœŸå¾…ï¼š${profile.hopeWords.join("ã€")}`, 
      `2026 ä¸»é¢˜ï¼š${gLabel}`, 
      `â€”`, 
      `æ ¸å¿ƒç‰Œç»„ï¼š${cNames}`, 
      `${oneLiner}`
    ].join("\n");
  }

  return [
    `Name: ${who}Â  | Age: ${profile.age}Â  | Zodiac: ${z}Â  | MBTI: ${mb}`,
Â  Â  Â  "", 
    `â€”`, 
    `2025 State Keywords: ${profile.selfWords.join(", ")}`, 
    `2026 Inner Hopes: ${profile.hopeWords.join(", ")}`,
    `Top 2026 Theme: ${gLabel}`,
    `â€”`,
    `Core Cards: ${cNames}`, 
    `${oneLiner}`
  ].join("\n");
}


/* =========================================================
   TREE THEME (based on cards + hope words) + GOAL ORNAMENTS
   ========================================================= */
function treeTheme(cards, hopeWords){
  const names = cards.map(c => c.nameEN);
  const hope = hopeWords.map(w => String(w).toLowerCase().trim());
  const future = names[2] || "";

  let color = "green";
  if(["The Sun","The World","The Lovers"].some(n => names.includes(n))) color = "red";
  if(["The Star","Temperance","The High Priestess"].some(n => names.includes(n))) color = "blue";
  if(["Death","The Hermit"].some(n => names.includes(n))) color = "deep";

  const vibrantWords = ["joy","confidence","excited","energy","bold","success","win","happy","love"];
  const softWords = ["rest","heal","balance","calm","peace","self-care","health","stability","steady","sleep"];
  let vibe = "soft";
  if(hope.some(w => vibrantWords.includes(w))) vibe = "vibrant";
  if(hope.some(w => softWords.includes(w)) && vibe !== "vibrant") vibe = "soft";

  if(future === "The Sun"){ color="red"; vibe="vibrant"; }
  if(future === "Temperance"){ color="blue"; }
  if(future === "The Star"){ color="blue"; }
  if(future === "The Hermit"){ color="deep"; vibe="soft"; }

  return { color, vibe };
}

function applyTreeTheme(theme){
  const root = document.documentElement.style;

  if(theme.color === "red"){
    if(theme.vibe === "vibrant"){
      // Vibrant Red
      root.setProperty("--treeA", "#f97316"); 
      root.setProperty("--treeB", "#ea580c");
      root.setProperty("--treeGlow", "rgba(234, 88, 12, .45)");
      root.setProperty("--treeStar", "rgba(255, 255, 180, .95)"); 
      root.setProperty("--treeStarGlow", "rgba(255, 255, 180, .70)");
    } else {
      // Soft Red
      root.setProperty("--treeA", "#fb7185"); 
      root.setProperty("--treeB", "#ef4444");
      root.setProperty("--treeGlow", "rgba(239, 68, 68, .28)");
      root.setProperty("--treeStar", "rgba(255, 214, 140, .95)");
      root.setProperty("--treeStarGlow", "rgba(255, 214, 140, .55)");
    }

  } else if(theme.color === "blue"){
    if(theme.vibe === "vibrant"){
      // Vibrant Blue
      root.setProperty("--treeA", "#06b6d4");
      root.setProperty("--treeB", "#0891b2");
      root.setProperty("--treeGlow", "rgba(6, 182, 212, .40)");
      root.setProperty("--treeStar", "rgba(255, 244, 200, .95)");
      root.setProperty("--treeStarGlow", "rgba(255, 244, 200, .60)");
    } else {
      // Soft Blue
      root.setProperty("--treeA", "#60a5fa");
      root.setProperty("--treeB", "#3b82f6");
      root.setProperty("--treeGlow", "rgba(96, 165, 250, .25)");
      root.setProperty("--treeStar", "rgba(255, 244, 200, .95)");
      root.setProperty("--treeStarGlow", "rgba(255, 244, 200, .50)");
    }

  } else if(theme.color === "deep"){
    // Deep themes
    root.setProperty("--treeA", "#1f2937");
    root.setProperty("--treeB", "#0f766e");
    root.setProperty("--treeGlow", theme.vibe === "vibrant" ? "rgba(15, 118, 110, .30)" : "rgba(15, 118, 110, .18)");
    root.setProperty("--treeStar", "rgba(216, 220, 255, .92)");
    root.setProperty("--treeStarGlow", "rgba(216, 220, 255, .45)");

  } else { // Default Green
    if(theme.vibe === "vibrant"){
      // Vibrant Green 
      root.setProperty("--treeA", "#4ade80"); 
      root.setProperty("--treeB", "#10b981"); 
      root.setProperty("--treeGlow", "rgba(16, 185, 129, .40)");
      root.setProperty("--treeStar", "rgba(255, 214, 140, .95)");
      root.setProperty("--treeStarGlow", "rgba(255, 214, 140, .60)");
    } else {
      // Soft Green
      root.setProperty("--treeA", "#34d399"); 
      root.setProperty("--treeB", "#059669"); 
      root.setProperty("--treeGlow", "rgba(16, 185, 129, .20)");
      root.setProperty("--treeStar", "rgba(255, 214, 140, .95)");
      root.setProperty("--treeStarGlow", "rgba(255, 214, 140, .50)");
    }
  }
}

function goalDecor(goal){
  const map = {
    love:  { icons:["ğŸ’›","ğŸ’","ğŸ’˜","ğŸŒŸ","ğŸ¥‚","ğŸ’–"], labelEN:"Love", labelZH:"çˆ±ä¸å…³ç³»" }, 
    family:{ icons:["ğŸ ","ğŸ«¶","ğŸ","âœ¨","ğŸ§¸","ğŸ«‚"], labelEN:"Family", labelZH:"å®¶åº­ä¸å½’å±" }, 
    health:{ icons:["ğŸƒ","ğŸ’ª","ğŸ§˜","âœ¨","ğŸ”‹","ğŸ’§"], labelEN:"Health", labelZH:"èº«å¿ƒå¥åº·" }, 
    career:{ icons:["â­","ğŸ“ˆ","ğŸ§ ","âœ¨","ğŸ¯","ğŸ’¼"], labelEN:"Career", labelZH:"äº‹ä¸šå‘å±•" }, 
    money:{ icons:["ğŸ’°","ğŸª™","ğŸ“Š","âœ¨","ğŸ¦","ğŸ’"], labelEN:"Money", labelZH:"è´¢åŠ¡è§„åˆ’" }, 
    "self-growth":{ icons:["ğŸŒ±","ğŸ“š","ğŸ§©","âœ¨","ğŸ’¡","ğŸ¦‹"], labelEN:"Self-growth", labelZH:"è‡ªæˆ‘èœ•å˜" }, 
    adventure:{ icons:["ğŸ§­","âœˆï¸","ğŸŒ™","âœ¨","ğŸ—ºï¸","ğŸš€"], labelEN:"Adventure", labelZH:"å†’é™©æ¢ç´¢" }, 
    creativity:{ icons:["ğŸ¨","ğŸ–Œï¸","ğŸ¼","âœ¨","ğŸ­","ğŸ’­"], labelEN:"Creativity", labelZH:"çµæ„Ÿä¸åˆ›ä½œ" }
  };
  return map[goal] || { icons:["ğŸ’«","ğŸŒŸ"], labelEN:"2026", labelZH:"å¹´åº¦å±•æœ›" };
}

function renderGoalOrnaments(goal){
  ornamentsEl.innerHTML = "";
  const cfg = goalDecor(goal);

  const pos = [
    {x:40,  y:65,  cls:"big"},   
    {x:115, y:80,  cls:"small"},
    {x:25,  y:118, cls:"small"},
    {x:125, y:125, cls:"big"},
    {x:70,  y:150, cls:"small"},
    {x:105, y:180, cls:"big"},
    {x:35,  y:185, cls:"small"}, 
  ];

pos.forEach((p, i)=>{
    const d = document.createElement("div");
    d.className = `orn ${p.cls} glowing-orn`; 
    d.style.left = p.x + "px";
    d.style.top  = p.y + "px";
    d.style.fontSize = (p.cls === "big") ? "30px" : "22px"; 
    d.style.animationDelay = (i * 0.24) + "s";
    d.textContent = cfg.icons[i % cfg.icons.length];
    ornamentsEl.appendChild(d);
  });
  const titleEl = document.getElementById("shareTitle");
  titleEl.textContent = (LANG==="zh")
    ? `2026 Â· ${cfg.labelZH}ä¸»é¢˜`
    : `2026 Â· ${cfg.labelEN} Theme`;
}

/* =========================================================
   PROFILE + VALIDATION
   ========================================================= */
function gatherProfile(){
  const age = clampAge(Number(ageInput.value));
  const selfWords = parseWords(selfInput.value);
  const hopeWords = parseWords(hopeInput.value);

  return {
    name: normalizeWords(nameInput.value),
    age,
    mbti: normalizeWords(mbtiInput.value),
    zodiac: zodiacSelect.value || "",
    selfWords,
    hopeWords,
    goal: goalSelect.value
  };
}

function validateProfile(profile){
  const L = t[LANG];
  if(profile.age == null){ showToast(L.needAge); return false; }
  if(!profile.zodiac){ showToast(L.needZodiac); return false; }
  if(!validateRange(profile.selfWords) || !validateRange(profile.hopeWords)){
    showToast(L.needWords);
    return false;
  }
  return true;
}

/* =========================================================
   ACTIONS: draw / reset / surprise / download
   ========================================================= */
function renderAll(){
  const profile = STATE.profile;
  const cards = STATE.cards;

  renderCards(cards);
  setChips(profile, cards);

  const reading = buildReading(profile, cards);
  renderReading(reading);

  shareBody.textContent = shareText(profile, cards, reading);
  shareMeta.textContent = t[LANG].shareGenerated;

  STATE.theme = treeTheme(cards, profile.hopeWords);
  applyTreeTheme(STATE.theme);
  renderGoalOrnaments(profile.goal);

  spreadTag.textContent = (LANG==="zh" ? "å·²ç”Ÿæˆ" : "Generated");
}

function doDraw(){
  const profile = gatherProfile();
  if(!validateProfile(profile)) return;

  if(!STATE.drawn){
    STATE.profile = profile;
    lockSelfWords(true);
  } else {
    profile.selfWords = (STATE.profile?.selfWords || profile.selfWords);
    STATE.profile = profile;
  }

  STATE.cards = pick3();
  STATE.drawn = true;

  statusPill.textContent = t[LANG].generated;
  renderAll();
  showToast(t[LANG].generated);
}

function doReset(){
  STATE.drawn = false;
  STATE.cards = [];
  STATE.profile = null;
  STATE.lockedSelf = false;
  selfInput.disabled = false;
  cardsEl.innerHTML = "";
  chipsEl.innerHTML = "";
  readingContent.innerHTML = ""; 
  shareBody.textContent = "";
  ornamentsEl.innerHTML = "";
  nameInput.value = "";
  ageInput.value = "";
  mbtiInput.value = "";
  zodiacSelect.value = "none";
  selfInput.value = "";   // Clears the "I feel..." keywords
  hopeInput.value = "";   // Clears the "I hope for..." keywords
  goalSelect.value = "career"; // Resets the 2026 goal selection
  spreadTag.textContent = t[LANG].notDrawn;
  shareMeta.textContent = t[LANG].shareReady;
  statusPill.textContent = t[LANG].ready;
  document.getElementById("disclaimer").textContent = "";

  showToast(t[LANG].ready);
}

function doSurprise(){
  const samples = [
    {name:"Mina", age:"22", mbti:"", zodiac:"leo", self:"curious, social, restless", hope:"love, calm, trust", goal:"love"},
    {name:"Jay", age:"30", mbti:"ENTP", zodiac:"virgo", self:"busy, ambitious, stressed", hope:"money, stability, focus", goal:"money"},
    {name:"Sofia", age:"19", mbti:"ISFJ", zodiac:"cancer", self:"nurturing, overworked, seeking balance", hope:"rhythm, peace, boundaries", goal:"health"},
    {name:"Ethan", age:"32", mbti:"INFJ", zodiac:"scorpio", self:"reflective, seeking purpose, ready for change", hope:"clarity, transformation, wisdom", goal:"self-growth"},
    {name:"Chloe", age:"29", mbti:"ESTP", zodiac:"sagittarius", self:"adventurous, impulsive, needs structure", hope:"focus, discipline, momentum", goal:"ambition"},
  ];
  const s = pickFrom(samples);
  nameInput.value = s.name;
  ageInput.value = s.age;
  mbtiInput.value = s.mbti;
  zodiacSelect.value = s.zodiac;
  selfInput.value = s.self;
  hopeInput.value = s.hope;
  goalSelect.value = s.goal;
  showToast(t[LANG].ready);
}

async function doDownload(){
  if(!STATE.drawn){
    showToast(t[LANG].notDrawn);
    return;
  }
  showToast(t[LANG].downloading);

  const node = document.getElementById("shareCard");
  try{
    const canvas = await html2canvas(node, {
      backgroundColor: "#ffffff",
      scale: 2,
      useCORS: true
    });
    const a = document.createElement("a");
    a.download = "holiday-tarot-2026.png";
    a.href = canvas.toDataURL("image/png");
    a.click();
    showToast(t[LANG].saved);
  } catch(e){
    console.error(e);
    showToast(t[LANG].downloadFail);
  }
}


/* =========================================================
   EVENTS + INIT
   ========================================================= */
document.getElementById("drawBtn").addEventListener("click", doDraw);
document.getElementById("resetBtn").addEventListener("click", doReset);
document.getElementById("surpriseBtn").addEventListener("click", doSurprise);
document.getElementById("downloadBtn").addEventListener("click", doDownload);
document.getElementById("oracleRollButton").addEventListener("click", generateOracleResult);

setLang("en");
spreadTag.textContent = t[LANG].notDrawn;
shareMeta.textContent = t[LANG].shareReady;
  </script>
</body>
</html>
